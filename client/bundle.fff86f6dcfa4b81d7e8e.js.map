{"version":3,"file":"bundle.fff86f6dcfa4b81d7e8e.js","mappings":"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","sources":["webpack://bombattack/./client/js/helpers/elements.js","webpack://bombattack/./client/js/states/boot.js","webpack://bombattack/./client/js/states/preload.js","webpack://bombattack/./client/js/states/menu.js","webpack://bombattack/./client/js/utils/constants.js","webpack://bombattack/./client/js/states/select_map.js","webpack://bombattack/./client/js/states/pending_game.js","webpack://bombattack/./client/js/utils/utils.js","webpack://bombattack/./client/js/entities/info.js","webpack://bombattack/./client/js/entities/player.js","webpack://bombattack/./client/js/entities/enemy_player.js","webpack://bombattack/./client/js/entities/bomb.js","webpack://bombattack/./client/js/entities/spoil.js","webpack://bombattack/./client/js/entities/fire_blast.js","webpack://bombattack/./client/js/entities/bone.js","webpack://bombattack/./client/js/states/play.js","webpack://bombattack/./client/js/states/win.js","webpack://bombattack/./client/js/app.js"],"sourcesContent":["export class Text extends Phaser.Text {\n\n  constructor({ game, x, y, text, style }) {\n    super(game, x, y, text, style);\n    this.anchor.setTo(0.5);\n\n    this.game.add.existing(this);\n  }\n\n}\n\nexport class Button extends Phaser.Button {\n\n  constructor({ game, x, y, asset, callback, callbackContext, overFrame, outFrame, downFrame, upFrame }) {\n    super(game, x, y, asset, callback, callbackContext, overFrame, outFrame, downFrame, upFrame);\n    this.anchor.setTo(0.5);\n\n    this.game.add.existing(this);\n  }\n\n}\n\nexport class TextButton extends Phaser.Button {\n\n  constructor({ game, x, y, asset, callback, callbackContext, overFrame, outFrame, downFrame, upFrame, label, style }) {\n    super(game, x, y, asset, callback, callbackContext, overFrame, outFrame, downFrame, upFrame);\n    this.anchor.setTo(0.5);\n\n    this.text = new Phaser.Text(this.game, 0, 0, label, style);\n    this.text.anchor.setTo(0.5);\n\n    this.addChild(this.text);\n\n    this.game.add.existing(this);\n  }\n\n  disable() {\n    this.setFrames(3, 3);\n    this.inputEnabled = false;\n    this.input.useHandCursor = false;\n  }\n\n  enable() {\n    this.setFrames(1, 0, 2);\n    this.inputEnabled = true;\n    this.input.useHandCursor = true;\n  }\n\n}\n\nexport class GameSlots extends Phaser.Group {\n\n  constructor({ game, availableGames, callback, callbackContext, x, y, style }) {\n    super(game);\n\n    let game_slot_asset = 'slot_backdrop'\n    let game_enter_asset = 'list_icon'\n\n    let yOffset = y;\n\n    for (let availableGame of availableGames) {\n      let gameBox = new Phaser.Image(this.game, x, yOffset, game_slot_asset)\n      let button = new Phaser.Button(this.game, gameBox.width - 100, 12, game_enter_asset, callback.bind(callbackContext, { game_id: availableGame.id }), null, 1, 0, 2, 1);\n      let text = new Phaser.Text(this.game, 30, 25, `Join Game: ${availableGame.name}`, style);\n\n      gameBox.addChild(button);\n      gameBox.addChild(text);\n\n      this.add(gameBox);\n\n      yOffset += 105;\n    }\n  }\n\n  destroy() {\n    this.callAll('kill') // destroy\n  }\n}\n\nexport class PlayerSlots extends Phaser.Group {\n\n  constructor({ game, max_players, players, x, y, asset_empty, asset_player, style }) {\n    super(game);\n\n    let xOffset = x;\n\n    for (let i = 0; i < max_players; i++) {\n      let slotBox\n      let slotName\n      let _player = players[i]\n\n      if (_player) {\n        slotBox = new Phaser.Image(this.game, xOffset, y, asset_player+_player.skin)\n        const label = _player.displayName || _player.skin;\n        slotName = new Phaser.Text(this.game, slotBox.width/2, slotBox.height + 15, label, style);\n        slotName.anchor.setTo(0.5);\n        slotBox.addChild(slotName);\n      } else {\n        slotBox = new Phaser.Image(this.game, xOffset, y, asset_empty)\n      }\n\n      this.add(slotBox);\n      xOffset += 170;\n    }\n  }\n\n  destroy() {\n    this.callAll('kill')\n  }\n}\n\nexport class SpoilNotification extends Phaser.Group {\n\n  constructor({ game, asset, x, y }) {\n    super(game)\n\n    this.picture = new Phaser.Image(this.game, x, y - 20, asset);\n    this.picture.anchor.setTo(0.5);\n\n    this.add(this.picture);\n\n    this.tween = this.game.add.tween(this.picture);\n    this.tween.to({ y: this.picture.y - 25, alpha: 0 }, 600);\n\n    this.tween.onComplete.add(this.finish, this);\n\n    this.tween.start()\n  }\n\n  finish() {\n    this.callAll('kill')\n  }\n}\n","import { Text } from '../helpers/elements';\n\nclass Boot extends Phaser.State {\n\n  create() {\n    // Make the game keep reacting to messages from the server even when the game window doesnt have focus.\n    // The game pauses when I open a new tab in the same window, but does not pause when I focus on another application\n    this.game.stage.disableVisibilityChange = true;\n\n    // Responsive scaling (stable on mobile, keeps aspect ratio)\n    // SHOW_ALL avoids distortion and keeps input coordinates consistent.\n    // It may add letterboxing on some aspect ratios, but gameplay + touch controls remain reliable.\n    this.game.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;\n    this.game.scale.pageAlignHorizontally = true;\n    this.game.scale.pageAlignVertically = true;\n\n    const refresh = () => {\n      try { this.game.scale.refresh(); } catch (_) {}\n    };\n\n    window.addEventListener('resize', refresh);\n    refresh();\n\n    const loadingText = new Text({\n      game: this.game,\n      x: this.game.world.centerX,\n      y: this.game.world.centerY,\n      text: 'Loading...',\n      style: {\n        font: '30px Arial, \"Noto Sans TC\", \"Microsoft JhengHei\", sans-serif',\n        fill: '#FFFFFF'\n      }\n    });\n\n    // Ensure CJK fonts are loaded before moving on; otherwise Phaser text may render as tofu.\n    const startNext = () => {\n      try { loadingText && loadingText.destroy && loadingText.destroy(); } catch (_) {}\n      this.state.start('Preload');\n    };\n\n    try {\n      if (document && document.fonts && document.fonts.load) {\n        Promise.all([\n          document.fonts.load('16px \"Noto Sans TC\"'),\n          document.fonts.load('16px \"Microsoft JhengHei\"'),\n          document.fonts.load('16px Arial'),\n        ]).then(startNext).catch(startNext);\n      } else {\n        startNext();\n      }\n    } catch (_) {\n      startNext();\n    }\n\n    // Mobile browsers often block audio until a user gesture.\n    // Unlock/resume audio on first tap/click.\n    try {\n      this.game.sound.mute = false;\n      this.game.input.onDown.addOnce(() => {\n        try {\n          if (this.game.sound && this.game.sound.context && this.game.sound.context.state === 'suspended') {\n            this.game.sound.context.resume();\n          }\n          if (this.game.sound && this.game.sound.unlock) {\n            this.game.sound.unlock();\n          }\n        } catch (_) {}\n      });\n    } catch (_) {}\n\n    // Transition to Preload happens via startNext() after fonts load.\n  }\n\n}\n\nexport default Boot;\n","class Preload extends Phaser.State {\n\n  preload() {\n    // Debug loader issues on mobile (use ?debug=1)\n    try {\n      this.load.onFileError.add((key, file) => {\n        try { if (window.UK01Log) window.UK01Log(`LOAD_ERR key=${key} url=${file && file.url}`); } catch (_) {}\n      });\n      this.load.onFileComplete.add((progress, key) => {\n        try {\n          if (window.UK01Loading) window.UK01Loading.set(progress, `${key}`);\n          if (window.UK01Log && progress < 100) window.UK01Log(`LOAD ${progress}% ${key}`);\n        } catch (_) {}\n      });\n      this.load.onLoadComplete.add(() => {\n        try {\n          if (window.UK01Loading) window.UK01Loading.set(100, '');\n          if (window.UK01Log) window.UK01Log('LOAD_DONE');\n        } catch (_) {}\n      });\n    } catch (_) {}\n    // Menu:\n    this.load.image('main_menu',     'images/menu/main_menu.png');\n    this.load.image('slot_backdrop', 'images/menu/slot_backdrop.png');\n\n    this.load.spritesheet('buttons',    'images/menu/buttons.png', 200, 75);\n    this.load.spritesheet('check_icon', 'images/menu/accepts.png', 75, 75);\n    this.load.spritesheet('list_icon',  'images/menu/game_enter.png', 75, 75);\n\n    this.load.image('hot_map_preview',   'images/menu/hot_map_preview.png');\n    this.load.image('cold_map_preview',  'images/menu/cold_map_preview.png');\n    // cache-bust to ensure clients fetch the updated preview\n    this.load.image('arena_map_preview', 'images/menu/arena_map_preview.png?v=2');\n    // cache-bust to ensure clients fetch the updated preview\n    this.load.image('open_map_preview',  'images/menu/open_map_preview.png?v=3');\n    this.load.image('rune_lab_preview',  'images/menu/rune_lab_preview.png?v=1');\n    this.load.image('mirror_temple_preview', 'images/menu/mirror_temple_preview.png?v=1');\n    this.load.image('trap_garden_preview', 'images/menu/trap_garden_preview.png?v=1');\n    this.load.image('prev',             'images/menu/left_arrow.png');\n    this.load.image('next',             'images/menu/right_arrow.png');\n\n    // Map:\n    this.load.image('tiles',      'maps/tileset.png');\n    this.load.tilemap('hot_map',   'maps/hot_map.json', null, Phaser.Tilemap.TILED_JSON);\n    this.load.tilemap('cold_map',  'maps/cold_map.json', null, Phaser.Tilemap.TILED_JSON);\n    this.load.tilemap('arena_map', 'maps/arena_map.json', null, Phaser.Tilemap.TILED_JSON);\n    this.load.tilemap('open_map',  'maps/open_map.json',  null, Phaser.Tilemap.TILED_JSON);\n    this.load.tilemap('rune_lab',  'maps/rune_lab.json',  null, Phaser.Tilemap.TILED_JSON);\n    this.load.tilemap('mirror_temple',  'maps/mirror_temple.json',  null, Phaser.Tilemap.TILED_JSON);\n    this.load.tilemap('trap_garden',  'maps/trap_garden.json',  null, Phaser.Tilemap.TILED_JSON);\n\n\n    // Game:\n    this.load.spritesheet('explosion_center',     'images/game/explosion_center.png',     35, 35);\n    this.load.spritesheet('explosion_horizontal', 'images/game/explosion_horizontal.png', 35, 35);\n    this.load.spritesheet('explosion_vertical',   'images/game/explosion_vertical.png',   35, 35);\n    this.load.spritesheet('explosion_up',         'images/game/explosion_up.png',         35, 35);\n    this.load.spritesheet('explosion_right',      'images/game/explosion_right.png',      35, 35);\n    this.load.spritesheet('explosion_down',       'images/game/explosion_down.png',       35, 35);\n    this.load.spritesheet('explosion_left',       'images/game/explosion_left.png',       35, 35);\n\n    this.load.spritesheet('spoil_tileset', 'images/game/spoil_tileset.png', 35, 35);\n    this.load.spritesheet('bone_tileset',  'images/game/bone_tileset.png', 35, 35);\n    this.load.spritesheet('bomb_tileset',  'images/game/bombs.png', 35, 35);\n\n    this.load.image('speed_up_bonus',    'images/game/speed_up_bonus.png');\n    this.load.image('speed_up_no_bonus', 'images/game/speed_up_no_bonus.png');\n    this.load.image('delay_up_bonus',    'images/game/delay_up_bonus.png');\n    this.load.image('delay_up_no_bonus', 'images/game/delay_up_no_bonus.png');\n    this.load.image('power_up_bonus',    'images/game/power_up_bonus.png');\n\n    this.load.image('placeholder_power', 'images/game/placeholder_power.png');\n    this.load.image('placeholder_speed', 'images/game/placeholder_speed.png');\n    this.load.image('placeholder_time',  'images/game/placeholder_time.png');\n\n    this.load.image('disease_icon',      'images/game/disease_icon.svg');\n    this.load.image('disease_tint',      'images/game/disease_icon.svg'); // Reuse icon for tint if needed\n\n    // Lighting / Atmosphere\n    this.load.image('light_mask',        'images/game/light_mask.svg');\n\n    // Special tiles FX\n    this.load.spritesheet('portal_fx', 'images/game/portal_fx.png', 35, 35);\n    this.load.spritesheet('speed_fx',  'images/game/speed_fx.png', 35, 35);\n    this.load.image('ghost_icon', 'images/game/ghost_icon.png');\n\n    // SFX / BGM (mobile may require user gesture to unlock audio)\n    this.load.audio('sfx_portal',    ['sfx/portal.wav']);\n    this.load.audio('sfx_speed',     ['sfx/speed.wav']);\n    this.load.audio('sfx_explosion', ['sfx/explosion.wav']);\n    this.load.audio('sfx_death',     ['sfx/death.wav']);\n    this.load.audio('bgm_main',      ['sfx/bgm.wav']);\n\n    // Cosmetics (paper-doll overlays)\n    // Cache-bust so clients reliably see updated PNGs\n    const COS_V = '20260206_14';\n    const cos = (p) => `images/game/cosmetics/${p}?v=${COS_V}`;\n\n    // Character bases\n    this.load.image('cosmetic_base', cos('base.png'));\n    this.load.image('cosmetic_char_1', cos('characters/char_1_pink_happy.png'));\n    this.load.image('cosmetic_char_2', cos('characters/char_2_pink_cry.png'));\n    this.load.image('cosmetic_char_3', cos('characters/char_3_yellow_happy.png'));\n    this.load.image('cosmetic_char_4', cos('characters/char_4_yellow_cry.png'));\n    this.load.image('cosmetic_char_5', cos('characters/char_5_blue_happy.png'));\n    this.load.image('cosmetic_char_6', cos('characters/char_6_blue_cry.png'));\n    this.load.image('cosmetic_char_7', cos('characters/char_7_mint_happy.png'));\n    this.load.image('cosmetic_char_8', cos('characters/char_8_mint_cry.png'));\n    // keep same footprint as original player sprite so children won't get culled\n    this.load.image('cosmetic_transparent', cos('transparent35.png'));\n\n    for (let i = 1; i <= 10; i++) {\n      this.load.image(`cosmetic_hat_${i}`, cos(`hat_${i}.png`));\n      this.load.image(`cosmetic_hair_${i}`, cos(`hair_${i}.png`));\n      this.load.image(`cosmetic_outfit_${i}`, cos(`outfit_${i}.png`));\n    }\n    for (let i = 1; i <= 4; i++) {\n      this.load.image(`cosmetic_face_${i}`, cos(`face_${i}.png`));\n    }\n    for (let i = 1; i <= 6; i++) {\n      this.load.image(`cosmetic_pattern_${i}`, cos(`pattern_${i}.png`));\n    }\n\n    // Skins:\n    this.load.image('bomberman_head_blank',     'images/game/chars/0-face.png');\n\n    this.load.image('bomberman_head_Theodora',  'images/game/chars/1-face.png');\n    this.load.image('bomberman_head_Ringo',     'images/game/chars/2-face.png');\n    this.load.image('bomberman_head_Jeniffer',  'images/game/chars/3-face.png');\n    this.load.image('bomberman_head_Godard',    'images/game/chars/4-face.png');\n    this.load.image('bomberman_head_Biarid',    'images/game/chars/5-face.png');\n    this.load.image('bomberman_head_Solia',     'images/game/chars/6-face.png');\n    this.load.image('bomberman_head_Kedan',     'images/game/chars/7-face.png');\n    this.load.image('bomberman_head_Nigob',     'images/game/chars/8-face.png');\n    this.load.image('bomberman_head_Baradir',   'images/game/chars/9-face.png');\n    this.load.image('bomberman_head_Raviel',    'images/game/chars/10-face.png');\n    this.load.image('bomberman_head_Valpo',     'images/game/chars/11-face.png');\n\n    this.load.spritesheet('bomberman_Theodora',  'images/game/chars/1-preview.png', 32, 32);\n    this.load.spritesheet('bomberman_Ringo',     'images/game/chars/2-preview.png', 32, 32);\n    this.load.spritesheet('bomberman_Jeniffer',  'images/game/chars/3-preview.png', 32, 32);\n    this.load.spritesheet('bomberman_Godard',    'images/game/chars/4-preview.png', 32, 32);\n    this.load.spritesheet('bomberman_Biarid',    'images/game/chars/5-preview.png', 32, 32);\n    this.load.spritesheet('bomberman_Solia',     'images/game/chars/6-preview.png', 32, 32);\n    this.load.spritesheet('bomberman_Kedan',     'images/game/chars/7-preview.png', 32, 32);\n    this.load.spritesheet('bomberman_Nigob',     'images/game/chars/8-preview.png', 32, 32);\n    this.load.spritesheet('bomberman_Baradir',   'images/game/chars/9-preview.png', 32, 32);\n    this.load.spritesheet('bomberman_Raviel',    'images/game/chars/10-preview.png', 32, 32);\n    this.load.spritesheet('bomberman_Valpo',     'images/game/chars/11-preview.png', 32, 32);\n  }\n\n  create() {\n    // Hide loading overlay\n    try { if (window.UK01Loading) window.UK01Loading.done(); } catch (_) {}\n    this.state.start('Menu');\n  }\n}\n\nexport default Preload;\n","import { Text, TextButton, GameSlots } from '../helpers/elements';\n\nclass Menu extends Phaser.State {\n\n  init() {\n    this.slotsWithGame = null;\n\n    clientSocket.on('display pending games', this.displayPendingGames.bind(this));\n  }\n\n  create() {\n    // Keep the background so the canvas isn't blank behind HTML overlay\n    let background = this.add.image(this.game.world.centerX, this.game.world.centerY, 'main_menu');\n    background.anchor.setTo(0.5);\n\n    // Use HTML overlay for mobile reliability\n    try {\n      if (window.UK01Menu && window.UK01Menu.showMenu) {\n        window.UK01Menu.showMenu();\n      }\n    } catch (_) {}\n\n    clientSocket.emit('enter lobby', this.displayPendingGames.bind(this));\n  }\n\n  update() {\n  }\n\n  hostGameAction() {\n    clientSocket.emit('leave lobby');\n    this.state.start('SelectMap');\n  }\n\n  displayPendingGames(availableGames) {\n    // NOTE: That is not optimal way to preview slots,\n    //       we should implement AddSlotToGroup, RemoveSlotFromGroup\n\n    // I triying to care about readability, not about performance.\n    if (this.slotsWithGame) {\n      this.slotsWithGame.destroy()\n    }\n\n    this.slotsWithGame = new GameSlots({\n      game: this.game,\n      availableGames: availableGames,\n      callback: this.joinGameAction,\n      callbackContext: this,\n      x: this.game.world.centerX - 220,\n      y: 160,\n      style: {\n        font: '35px Arial, \"Noto Sans TC\", \"Microsoft JhengHei\", sans-serif',\n        fill: '#efefef',\n        stroke: '#ae743a',\n        strokeThickness: 3\n      }\n    })\n  }\n\n  joinGameAction(game_id) {\n    clientSocket.emit('leave lobby');\n    // https://phaser.io/docs/2.6.2/Phaser.StateManager.html#start\n    this.state.start('PendingGame', true, false, game_id);\n  }\n}\n\nexport default Menu;\n","export const TILE_SIZE = 35;\nexport const PING = 200; // Expected latency for tweening\n\n// Bomb\nexport const EXPLOSION_TIME = 2000;\n\n// Tile Indices\nexport const EMPTY_CELL = 0;\nexport const DESTRUCTIBLE_CELL = 2;\nexport const NON_DESTRUCTIBLE_CELL = 1;\n\n// Map Layers\nexport const TILESET = 'tiles';\nexport const LAYER = 'layer_1';\n\nexport const AVAILABLE_MAPS = [\n  'hot_map', 'cold_map', 'arena_map', 'open_map',\n  'rune_lab', 'mirror_temple', 'trap_garden'\n];\n\nexport const MAX_PLAYERS = 4;\n\n// Player stats (keep in sync with server/constants.js)\nexport const INITIAL_SPEED = 150;\nexport const STEP_SPEED = 50;\nexport const MAX_SPEED = 350;\n\nexport const INITIAL_DELAY = 2000;\nexport const STEP_DELAY = 500;\nexport const MIN_DELAY = 500;\n\nexport const INITIAL_POWER = 1;\nexport const STEP_POWER = 1;\n\n// Spoil Types (Must match server)\n// New-style constants used by newer code\nexport const SPOIL_SPEED = 0;\nexport const SPOIL_POWER = 1;\nexport const SPOIL_DELAY = 2;\nexport const SPOIL_SHIELD = 3;\nexport const SPOIL_REMOTE = 4;\nexport const SPOIL_KICK = 5;\nexport const SPOIL_GHOST = 6;\nexport const SPOIL_DISEASE = 7;\nexport const SPOIL_LIFE = 8;\nexport const SPOIL_PASSWALL = 9;\nexport const SPOIL_REVERSE = 10;\nexport const SPOIL_BOMB_UP = 11;\nexport const SPOIL_BOMB_PASS = 12;\nexport const SPOIL_SLOW = 13;\nexport const SPOIL_CONFUSE = 14;\nexport const SPOIL_MINE = 15;\nexport const SPOIL_THROW = 16;\nexport const SPOIL_MAGNET = 17;\n\n// Back-compat constants used by legacy client code\nexport const SPEED = SPOIL_SPEED;\nexport const POWER = SPOIL_POWER;\nexport const DELAY = SPOIL_DELAY;\nexport const SHIELD = SPOIL_SHIELD;\nexport const REMOTE = SPOIL_REMOTE;\nexport const KICK = SPOIL_KICK;\nexport const GHOST = SPOIL_GHOST;\nexport const LIFE = SPOIL_LIFE;\nexport const PASSWALL = SPOIL_PASSWALL;\nexport const REVERSE = SPOIL_REVERSE;\nexport const BOMB_UP = SPOIL_BOMB_UP;\nexport const BOMB_PASS = SPOIL_BOMB_PASS;\nexport const SLOW = SPOIL_SLOW;\nexport const CONFUSE = SPOIL_CONFUSE;\nexport const MINE = SPOIL_MINE;\nexport const THROW = SPOIL_THROW;\nexport const MAGNET = SPOIL_MAGNET;\n\n// Timed powerups\nexport const SHIELD_DURATION_MS = 3000;\nexport const GHOST_DURATION_MS = 15000;\n\n// Special Tile IDs (from Tiled map)\nexport const TILE_PORTAL = 2; // Usually the balk tile id, need check\nexport const TILE_SPEED_FLOOR = 3; // Example id\n","import { AVAILABLE_MAPS } from '../utils/constants';\nimport { Text, Button } from '../helpers/elements';\n\nclass SelectMap extends Phaser.State {\n\n  init() {\n    this.slider = new phaseSlider(this);\n  }\n\n  create() {\n    // Select map is handled by HTML overlay now.\n    // Keep background to avoid blank canvas and immediately return to Menu.\n    let background = this.add.image(this.game.world.centerX, this.game.world.centerY, 'main_menu');\n    background.anchor.setTo(0.5);\n\n    try {\n      if (window.UK01Menu && window.UK01Menu.showMaps) {\n        window.UK01Menu.showMaps();\n      }\n    } catch (_) {}\n\n    // no-op\n  }\n\n  confirmStageSelection() {\n    let map_name = AVAILABLE_MAPS[this.slider.getCurrentIndex()]\n\n    clientSocket.emit('create game', map_name, this.joinToNewGame.bind(this));\n  }\n\n  joinToNewGame(payload) {\n    // server callback may return either a plain id string or an object { game_id }\n    if (payload && payload.error) {\n      // Minimal UX: browser alert (works in Phaser environment)\n      alert(payload.message || payload.error);\n      return;\n    }\n\n    const game_id = (payload && payload.game_id) ? payload.game_id : payload;\n    this.state.start('PendingGame', true, false, game_id);\n  }\n}\n\nexport default SelectMap;\n","import { Text, Button, TextButton, PlayerSlots } from '../helpers/elements';\n\nclass PendingGame extends Phaser.State {\n\n  init(payload) {\n    this.slotsWithPlayer = null;\n\n    // Phaser may pass init params as a plain value (game_id) or as an object { game_id }\n    this.game_id = (payload && payload.game_id) ? payload.game_id : payload;\n\n    clientSocket.on('update game', this.displayGameInfo.bind(this));\n    clientSocket.on('launch game', this.launchGame.bind(this));\n\n    clientSocket.emit('enter pending game', { game_id: this.game_id });\n  }\n\n  create() {\n    let background = this.add.image(this.game.world.centerX, this.game.world.centerY, 'main_menu');\n    background.anchor.setTo(0.5);\n\n    // Use HTML overlay for mobile reliability\n    try {\n      if (window.UK01Pending && window.UK01Pending.show) {\n        window.UK01Pending.show();\n      }\n      // hide main menu overlay if visible\n      if (window.UK01Menu && window.UK01Menu.hideMenu) {\n        window.UK01Menu.hideMenu();\n      }\n    } catch (_) {}\n\n    // keep minimal title text in canvas (optional)\n    this.gameTitle = new Text({\n      game: this.game,\n      x: this.game.world.centerX,\n      y: this.game.world.centerY - 215,\n      text: '',\n      style: {\n        font: '35px Arial, \"Noto Sans TC\", \"Microsoft JhengHei\", sans-serif',\n        fill: '#9ec0ba',\n        stroke: '#6f7975',\n        strokeThickness: 3\n      }\n    })\n  }\n\n  setAICount(n) {\n    this.aiCount = Math.max(0, Math.min(3, n));\n    if (this.aiText) this.aiText.text = `AI: ${this.aiCount}`;\n\n    clientSocket.emit('set ai count', { count: this.aiCount });\n  }\n\n  setAIDifficulty(difficulty) {\n    this.aiDifficulty = difficulty;\n    if (this.aiDiffText) this.aiDiffText.text = `: ${this.aiDifficulty}`;\n\n    clientSocket.emit('set ai difficulty', { difficulty: this.aiDifficulty });\n  }\n\n  displayGameInfo({ current_game }) {\n    let players = Object.values(current_game.players);\n\n    this.gameTitle.text = current_game.name\n\n    if (this.slotsWithPlayer) {\n      this.slotsWithPlayer.destroy()\n    }\n\n    this.slotsWithPlayer = new PlayerSlots({\n      game: this.game,\n      max_players: current_game.max_players,\n      players: players,\n      x: this.game.world.centerX - 245,\n      y: this.game.world.centerY - 80,\n      asset_empty: 'bomberman_head_blank',\n      asset_player: 'bomberman_head_',\n      style: {\n        font: '20px Arial, \"Noto Sans TC\", \"Microsoft JhengHei\", sans-serif',\n        fill: '#48291c'\n      }\n    })\n\n    // Update HTML overlay\n    try {\n      if (window.UK01Pending && window.UK01Pending.updateFromGame) {\n        window.UK01Pending.updateFromGame(current_game);\n      }\n    } catch (_) {}\n  }\n\n  leaveGameAction() {\n    clientSocket.emit('leave pending game');\n\n    this.state.start('Menu');\n  }\n\n  startGameAction() {\n    clientSocket.emit('start game');\n  }\n\n  launchGame(game) {\n    this.state.start('Play', true, false, game);\n  }\n}\n\nexport default PendingGame;\n","export const findFrom = function(id, entities) {\n  for (let entity of entities.children) {\n    if (entity.id !== id) { continue }\n\n    return entity\n  }\n  return null;\n}\n\nexport const findAndDestroyFrom = function(id, entities) {\n  let entity = findFrom(id, entities);\n  if (!entity) { return }\n\n  entity.destroy()\n}\n","export default class Info {\n\n  constructor({ game, player }) {\n    this.game = game;\n    this.player = player;\n\n    this.style    = { font: '14px Arial', fill: '#ffffff', align: 'left' }\n    this.redStyle = { font: '30px Arial', fill: '#ff0044', align: 'center' };\n\n    // HUD group (sticks to camera)\n    this.hud = this.game.add.group();\n    this.hud.fixedToCamera = true;\n\n    let bootsIcon  = new Phaser.Image(this.game, 5, 2, 'placeholder_speed');\n    this.speedText = new Phaser.Text(this.game, 35, 7, this.speedLabel(), this.style);\n    bootsIcon.addChild(this.speedText)\n    this.hud.add(bootsIcon);\n\n    let powerIcon  = new Phaser.Image(this.game, 110, 2, 'placeholder_power');\n    this.powerText = new Phaser.Text(this.game, 35, 7, this.powerLabel(), this.style);\n    powerIcon.addChild(this.powerText)\n    this.hud.add(powerIcon);\n\n    let delayIcon  = new Phaser.Image(this.game, 215, 2, 'placeholder_time');\n    this.delayText = new Phaser.Text(this.game, 35, 7, this.delayLabel(), this.style);\n    delayIcon.addChild(this.delayText)\n    this.hud.add(delayIcon);\n\n    // Lives\n    let lifeIcon = new Phaser.Image(this.game, 320, 2, 'placeholder_power');\n    lifeIcon.alpha = 0.7;\n    this.lifeText = new Phaser.Text(this.game, 35, 7, this.lifeLabel(), this.style);\n    lifeIcon.addChild(this.lifeText);\n    this.hud.add(lifeIcon);\n\n    // Bomb capacity + mine ammo (compact)\n    let bombIcon = new Phaser.Image(this.game, 425, 2, 'placeholder_time');\n    bombIcon.alpha = 0.6;\n    this.bombText = new Phaser.Text(this.game, 35, 7, this.bombLabel(), this.style);\n    bombIcon.addChild(this.bombText);\n    this.hud.add(bombIcon);\n\n    // Ghost powerup indicator (hidden unless active)\n    let ghostIcon = new Phaser.Image(this.game, 320, 2, 'ghost_icon');\n    ghostIcon.alpha = 0.85;\n    this.ghostText = new Phaser.Text(this.game, 35, 7, '', this.style);\n    ghostIcon.addChild(this.ghostText);\n    ghostIcon.visible = false;\n    this.ghostIcon = ghostIcon;\n    this.hud.add(ghostIcon);\n\n    this._ghostTimer = null;\n\n    this.deadText = this.game.add.text(this.game.world.centerX, this.game.world.height - 30, 'You died :(', this.redStyle);\n    this.deadText.anchor.set(0.5);\n    this.deadText.visible = false;\n    this.deadText.fixedToCamera = true;\n  }\n\n  refreshStatistic() {\n    this.speedText.text = this.speedLabel();\n    this.powerText.text = this.powerLabel();\n    this.delayText.text = this.delayLabel();\n    if (this.lifeText) this.lifeText.text = this.lifeLabel();\n    if (this.bombText) this.bombText.text = this.bombLabel();\n  }\n\n  refreshLives() {\n    if (this.lifeText) this.lifeText.text = this.lifeLabel();\n  }\n\n  refreshBombs() {\n    if (this.bombText) this.bombText.text = this.bombLabel();\n  }\n\n  showGhost(ghostUntilMs) {\n    if (!this.ghostIcon) return;\n\n    this.ghostIcon.visible = true;\n\n    if (this._ghostTimer) {\n      try { this.game.time.events.remove(this._ghostTimer); } catch (_) {}\n      this._ghostTimer = null;\n    }\n\n    const tick = () => {\n      const left = Math.max(0, ghostUntilMs - this.game.time.now);\n      this.ghostText.text = `${(left / 1000).toFixed(1)}s`;\n\n      if (left <= 0) {\n        this.hideGhost();\n      }\n    };\n\n    tick();\n    this._ghostTimer = this.game.time.events.loop(150, tick);\n  }\n\n  hideGhost() {\n    if (this.ghostIcon) this.ghostIcon.visible = false;\n    if (this._ghostTimer) {\n      try { this.game.time.events.remove(this._ghostTimer); } catch (_) {}\n      this._ghostTimer = null;\n    }\n  }\n\n  showDeadInfo() {\n    this.deadText.visible = true\n  }\n\n  speedLabel() {\n    return this.player.speed\n  }\n\n  powerLabel() {\n    return `x ${this.player.power}`\n  }\n\n  delayLabel() {\n    return `${this.player.delay / 1000} sec.`\n  }\n\n  lifeLabel() {\n    return `x ${this.player.lives || 0}`\n  }\n\n  bombLabel() {\n    const mb = this.player.maxBombs || 1;\n    const mine = this.player.mineAmmo || 0;\n    return `${mb}B ${mine}M`;\n  }\n}\n","import {\n  PING, TILE_SIZE, MAX_SPEED, STEP_SPEED, INITIAL_SPEED, SPEED, POWER, DELAY,\n  MIN_DELAY, STEP_DELAY, INITIAL_DELAY, INITIAL_POWER, STEP_POWER,\n  SHIELD, REMOTE, KICK, GHOST, LIFE, PASSWALL, REVERSE, BOMB_UP, BOMB_PASS, SLOW, CONFUSE, MINE, THROW, MAGNET, SPOIL_DISEASE,\n  SHIELD_DURATION_MS, GHOST_DURATION_MS\n} from '../utils/constants';\n\nimport Info from './info';\nimport { SpoilNotification, Text } from '../helpers/elements';\n\nexport default class Player extends Phaser.Sprite {\n\n  constructor({ game, id, spawn, skin, displayName, avatarParts }) {\n    super(game, spawn.x, spawn.y, 'bomberman_' + skin);\n\n    this.game = game;\n    this.id = id;\n\n    this.prevPosition = { x: spawn.x, y: spawn.y };\n\n    this.delay = INITIAL_DELAY;\n    this.power = INITIAL_POWER;\n    this.speed = INITIAL_SPEED;\n    this.tileSpeedMultiplier = 1.0;\n    this._lastBombTime = 0;\n\n    // powerups\n    this.shieldUntil = 0;\n    this.ghostUntil = 0;\n    this.hasRemote = false;\n    this.hasKick = false;\n    this.diseaseUntil = 0; // Client-side tracking\n    this.passwallUntil = 0;\n    this.reverseUntil = 0;\n    this.slowUntil = 0;\n    this.confuseUntil = 0;\n\n    this.lives = 3;\n    this.maxLives = 5;\n\n    this.maxBombs = 1;\n    this.hasBombPass = false;\n    this.mineAmmo = 0;\n\n    this.hasThrow = false;\n    this.magnetUntil = 0;\n\n    this.game.add.existing(this);\n    this.game.physics.arcade.enable(this);\n    this.body.setSize(20, 20, 6, 6);\n\n    // Touch controls state (set by Play state UI)\n    this.touchLeft = false;\n    this.touchRight = false;\n    this.touchUp = false;\n    this.touchDown = false;\n    this.touchBomb = false;\n\n    game.time.events.loop(PING , this.positionUpdaterLoop.bind(this));\n\n    this.animations.add('up', [9, 10, 11], 15, true);\n    this.animations.add('down', [0, 1, 2], 15, true);\n    this.animations.add('right', [6, 7, 8], 15, true);\n    this.animations.add('left', [3, 4, 5], 15, true);\n\n    this.info = new Info({ game: this.game, player: this });\n\n    this.defineKeyboard()\n    this.defineSelf(displayName || skin)\n\n    // Paper-doll cosmetics (hair/outfit/hat): simple layered images above base sprite\n    this.avatarParts = avatarParts || null;\n    this.applyAvatarParts(this.avatarParts);\n  }\n\n  update() {\n    if (this.alive) {\n      this.handleMoves()\n      this.handleBombs()\n    }\n\n    this.animateCosmetics();\n\n    // this.game.debug.body(this);\n    // this.game.debug.spriteInfo(this, 32, 32);\n  }\n\n  defineKeyboard() {\n    // Arrow keys\n    this.upKey    = this.game.input.keyboard.addKey(Phaser.Keyboard.UP)\n    this.downKey  = this.game.input.keyboard.addKey(Phaser.Keyboard.DOWN)\n    this.leftKey  = this.game.input.keyboard.addKey(Phaser.Keyboard.LEFT)\n    this.rightKey = this.game.input.keyboard.addKey(Phaser.Keyboard.RIGHT)\n\n    // WASD\n    this.wKey = this.game.input.keyboard.addKey(Phaser.Keyboard.W)\n    this.aKey = this.game.input.keyboard.addKey(Phaser.Keyboard.A)\n    this.sKey = this.game.input.keyboard.addKey(Phaser.Keyboard.S)\n    this.dKey = this.game.input.keyboard.addKey(Phaser.Keyboard.D)\n\n    // Bomb\n    this.spaceKey = this.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR)\n  }\n\n  handleMoves() {\n    this.body.velocity.set(0);\n    let animationsArray = []\n\n    let effectiveSpeed = this.speed * (this.tileSpeedMultiplier || 1.0);\n    if (this.isSlowed && this.isSlowed()) effectiveSpeed *= 0.55;\n\n    let left  = this.leftKey.isDown  || (this.aKey && this.aKey.isDown) || this.touchLeft;\n    let right = this.rightKey.isDown || (this.dKey && this.dKey.isDown) || this.touchRight;\n    let up    = this.upKey.isDown    || (this.wKey && this.wKey.isDown) || this.touchUp;\n    let down  = this.downKey.isDown  || (this.sKey && this.sKey.isDown) || this.touchDown;\n\n    // Reverse controls effect\n    if (this.isReversed && this.isReversed()) {\n      const l = left, r = right, u = up, d = down;\n      left = r; right = l; up = d; down = u;\n    }\n\n    // Confuse: swap left/right and up/down (classic-ish)\n    if (this.isConfused && this.isConfused()) {\n      const l = left, r = right, u = up, d = down;\n      left = r; right = l; up = d; down = u;\n    }\n\n    // Slow: reduce effective speed\n    if (this.isSlowed && this.isSlowed()) {\n      // handled via multiplier below\n    }\n\n    if (left){\n      this.body.velocity.x = -effectiveSpeed;\n      animationsArray.push('left')\n      this._lastDir = 'left';\n    } else if (right) {\n      this.body.velocity.x = effectiveSpeed;\n      animationsArray.push('right')\n      this._lastDir = 'right';\n    }\n\n    if (up) {\n      this.body.velocity.y = -effectiveSpeed;\n      animationsArray.push('up')\n      this._lastDir = 'up';\n    } else if (down) {\n      this.body.velocity.y = effectiveSpeed;\n      animationsArray.push('down')\n      this._lastDir = 'down';\n    }\n\n    let currentAnimation = animationsArray[0]\n    if (currentAnimation){\n      this.animations.play(currentAnimation)\n      return\n    }\n\n    this.animations.stop();\n  }\n\n  handleBombs() {\n    const bombDown = this.game.input.keyboard.isDown(Phaser.Keyboard.SPACEBAR) || this.touchBomb;\n    const now = this.game.time.now;\n\n    if (bombDown && !this._bombHeld) {\n      this._bombHeld = true;\n      this._bombDownAt = now;\n      this._bombLongTriggered = false;\n    }\n\n    // Long press: throw bomb\n    if (bombDown && this._bombHeld && !this._bombLongTriggered && this.hasThrow && (now - (this._bombDownAt || 0) > 380)) {\n      this._bombLongTriggered = true;\n      this._lastBombTime = now + this.delay;\n\n      // Determine direction from current input intent\n      const left  = this.touchLeft || (this.leftKey && this.leftKey.isDown) || (this.aKey && this.aKey.isDown);\n      const right = this.touchRight || (this.rightKey && this.rightKey.isDown) || (this.dKey && this.dKey.isDown);\n      const up    = this.touchUp || (this.upKey && this.upKey.isDown) || (this.wKey && this.wKey.isDown);\n      const down  = this.touchDown || (this.downKey && this.downKey.isDown) || (this.sKey && this.sKey.isDown);\n\n      let dir = this._lastDir || 'down';\n      if (left) dir = 'left';\n      else if (right) dir = 'right';\n      else if (up) dir = 'up';\n      else if (down) dir = 'down';\n\n      clientSocket.emit('throw bomb', { dir, range: 3 });\n      return;\n    }\n\n    // On release: place bomb once (short press)\n    if (!bombDown && this._bombHeld) {\n      this._bombHeld = false;\n      if (!this._bombLongTriggered && now > this._lastBombTime) {\n        this._lastBombTime = now + this.delay;\n        clientSocket.emit('create bomb', { col: this.currentCol(), row: this.currentRow() });\n      }\n    }\n  }\n\n  currentCol() {\n    return Math.floor(this.body.position.x / TILE_SIZE)\n  }\n\n  currentRow() {\n    return Math.floor(this.body.position.y / TILE_SIZE)\n  }\n\n  positionUpdaterLoop() {\n    let newPosition = { x: this.position.x, y: this.position.y }\n\n    if (this.prevPosition.x !== newPosition.x || this.prevPosition.y !== newPosition.y) {\n      clientSocket.emit('update player position', newPosition);\n      this.prevPosition = newPosition;\n    }\n  }\n\n  becomesDead() {\n    this.info.showDeadInfo()\n    this.kill();\n  }\n\n  pickSpoil( spoil_type ){\n    if ( spoil_type === SPEED ){ this.increaseSpeed() }\n    if ( spoil_type === POWER ){ this.increasePower() }\n    if ( spoil_type === DELAY ){ this.increaseDelay() }\n    if ( spoil_type === SHIELD ){ this.activateShield() }\n    if ( spoil_type === REMOTE ){ this.enableRemote() }\n    if ( spoil_type === KICK ){ this.enableKick() }\n    if ( spoil_type === GHOST ){ this.activateGhost() }\n    if ( spoil_type === SPOIL_DISEASE ){ this.infectDisease() }\n\n    if ( spoil_type === LIFE ){ this.gainLife() }\n    if ( spoil_type === PASSWALL ){ this.activatePassWall() }\n    if ( spoil_type === REVERSE ){ this.activateReverse() }\n\n    if ( spoil_type === BOMB_UP ){ this.increaseBombCapacity() }\n    if ( spoil_type === BOMB_PASS ){ this.enableBombPass() }\n    if ( spoil_type === SLOW ){ this.activateSlow() }\n    if ( spoil_type === CONFUSE ){ this.activateConfuse() }\n    if ( spoil_type === MINE ){ this.gainMine() }\n    if ( spoil_type === THROW ){ this.enableThrow() }\n    if ( spoil_type === MAGNET ){ this.activateMagnet() }\n  }\n\n  isShielded() {\n    return this.shieldUntil && this.game.time.now < this.shieldUntil;\n  }\n\n  isGhosted() {\n    return this.ghostUntil && this.game.time.now < this.ghostUntil;\n  }\n\n  isDiseased() {\n    return this.diseaseUntil && this.game.time.now < this.diseaseUntil;\n  }\n\n  isSlowed() {\n    return this.slowUntil && this.game.time.now < this.slowUntil;\n  }\n\n  isConfused() {\n    return this.confuseUntil && this.game.time.now < this.confuseUntil;\n  }\n\n  increaseBombCapacity() {\n    this.maxBombs = Math.min(5, (this.maxBombs || 1) + 1);\n    if (this.info && this.info.refreshBombs) this.info.refreshBombs();\n  }\n\n  enableBombPass() {\n    this.hasBombPass = true;\n    // Visual hint\n    this.game.time.events.add(250, () => { try { this.tint = 0x99ddff; } catch (_) {} });\n  }\n\n  activateSlow() {\n    this.slowUntil = this.game.time.now + 9000;\n    this.tint = 0x88aaff;\n    this.game.time.events.add(9000, () => {\n      if (!this.isShielded() && !this.isGhosted() && !this.isPassWalled() && !this.isDiseased() && !this.isReversed() && !this.isConfused()) {\n        this.tint = 0xffffff;\n      }\n    });\n  }\n\n  activateConfuse() {\n    this.confuseUntil = this.game.time.now + 8000;\n    this.tint = 0xffffff;\n    this.game.time.events.add(8000, () => {\n      if (!this.isShielded() && !this.isGhosted() && !this.isPassWalled() && !this.isDiseased() && !this.isReversed() && !this.isSlowed()) {\n        this.tint = 0xffffff;\n      }\n    });\n  }\n\n  gainMine() {\n    this.mineAmmo = Math.min(5, (this.mineAmmo || 0) + 1);\n    if (this.info && this.info.refreshBombs) this.info.refreshBombs();\n  }\n\n  enableThrow() {\n    this.hasThrow = true;\n    try { new SpoilNotification({ game: this.game, asset: 'placeholder_speed', x: this.position.x, y: this.position.y }); } catch (_) {}\n  }\n\n  activateMagnet() {\n    this.magnetUntil = this.game.time.now + 10000;\n    this.tint = 0x66ccff;\n    this.game.time.events.add(10000, () => {\n      if (!this.isShielded() && !this.isGhosted() && !this.isPassWalled() && !this.isDiseased() && !this.isReversed() && !this.isConfused() && !this.isSlowed()) {\n        this.tint = 0xffffff;\n      }\n    });\n  }\n\n  isMagnetOn() {\n    return this.magnetUntil && this.game.time.now < this.magnetUntil;\n  }\n\n  increaseSpeed(){\n    let asset = 'speed_up_no_bonus'\n\n    if (this.speed < MAX_SPEED) {\n      this.speed = this.speed + STEP_SPEED;\n      this.info.refreshStatistic();\n      asset = 'speed_up_bonus'\n    }\n\n    new SpoilNotification({ game: this.game, asset: asset, x: this.position.x, y: this.position.y })\n  }\n\n  increaseDelay(){\n    let asset = 'delay_up_no_bonus'\n\n    if (this.delay > MIN_DELAY){\n      this.delay -= STEP_DELAY;\n      this.info.refreshStatistic();\n      asset = 'delay_up_bonus'\n    }\n\n    new SpoilNotification({ game: this.game, asset: asset, x: this.position.x, y: this.position.y })\n  }\n\n  increasePower(){\n    let asset = 'power_up_bonus'\n\n    this.power += STEP_POWER;\n    this.info.refreshStatistic();\n\n    new SpoilNotification({ game: this.game, asset: asset, x: this.position.x, y: this.position.y })\n  }\n\n  activateShield() {\n    this.shieldUntil = this.game.time.now + SHIELD_DURATION_MS;\n\n    // Simple visual: flash tint while shielded\n    this.tint = 0x66ccff;\n    this.game.time.events.add(SHIELD_DURATION_MS, () => {\n      // If ghost is active, keep ghost visual\n      if (this.isGhosted && this.isGhosted()) {\n        this.tint = 0xa7f7ff;\n        this.alpha = 0.65;\n      } else {\n        this.tint = 0xffffff;\n      }\n    });\n\n    new SpoilNotification({ game: this.game, asset: 'placeholder_time', x: this.position.x, y: this.position.y })\n  }\n\n  enableRemote() {\n    this.hasRemote = true;\n    new SpoilNotification({ game: this.game, asset: 'placeholder_power', x: this.position.x, y: this.position.y })\n  }\n\n  enableKick() {\n    this.hasKick = true;\n    new SpoilNotification({ game: this.game, asset: 'placeholder_speed', x: this.position.x, y: this.position.y })\n  }\n\n  applyAvatarParts(parts) {\n    try {\n      // clear old\n      if (this._cosmetics) {\n        for (const s of this._cosmetics) {\n          try { s.destroy(); } catch (_) {}\n        }\n      }\n      this._cosmetics = [];\n\n      if (!parts) return;\n      const add = (key, x, y, alpha=1) => {\n        if (!key) return;\n        const spr = this.game.add.sprite(x, y, key);\n        spr.anchor.setTo(0.5);\n        // cosmetics assets are 128x128 but we display them slightly larger than 32x32\n        spr.scale.setTo(0.34);\n        spr.alpha = alpha;\n        spr._baseY = y;\n        this.addChild(spr);\n        this._cosmetics.push(spr);\n      };\n\n      // Base character\n      const baseKey = (parts && parts.character) ? ('cosmetic_' + parts.character) : 'cosmetic_base';\n      add(baseKey, 16, 16, 1);\n\n      // Preloaded as images: cosmetic_hair_X, cosmetic_outfit_X, cosmetic_hat_X\n      const hair = parts.hair ? ('cosmetic_' + parts.hair) : null;\n      const outfit = parts.outfit ? ('cosmetic_' + parts.outfit) : null;\n      const hat = parts.hat ? ('cosmetic_' + parts.hat) : null;\n      const face = parts.face ? ('cosmetic_' + parts.face) : null;\n      const pattern = parts.pattern ? ('cosmetic_' + parts.pattern) : null;\n\n      // Hide legacy bomberman sprite underneath (keep physics/body) without affecting children.\n      try { this.loadTexture('cosmetic_transparent'); } catch (_) {}\n\n      // tuned offsets so accessories don't cover the face by default\n      add(outfit, 16, 22, 0.98);\n      add(pattern,16, 22, 0.99);\n      add(face,   16, 14, 0.995);\n      add(hair,   16, 12, 0.999);\n      add(hat,    16, 6,  0.999);\n    } catch (_) {}\n  }\n\n  animateCosmetics() {\n    try {\n      if (!this._cosmetics || !this._cosmetics.length) return;\n\n      const moving = Math.abs(this.body.velocity.x) > 1 || Math.abs(this.body.velocity.y) > 1;\n      if (!this._cosBobT) this._cosBobT = 0;\n\n      if (moving) {\n        this._cosBobT += (this.game.time.elapsedMS || 16);\n      } else {\n        // decay to rest\n        this._cosBobT = 0;\n      }\n\n      const bob = moving ? Math.sin(this._cosBobT / 90.0) * 1.6 : 0;\n\n      for (const s of this._cosmetics) {\n        if (!s) continue;\n        const by = (typeof s._baseY === 'number') ? s._baseY : s.y;\n        s.y = by + bob;\n      }\n    } catch (_) {}\n  }\n\n  activateGhost() {\n    this.ghostUntil = this.game.time.now + GHOST_DURATION_MS;\n\n    // Visual: semi-transparent + cool tint\n    this.alpha = 0.65;\n    this.tint = 0xa7f7ff;\n\n    // HUD indicator + countdown\n    if (this.info && this.info.showGhost) {\n      this.info.showGhost(this.ghostUntil);\n    }\n\n    // Clear visual at end (unless shield overwrote tint, reset to white)\n    this.game.time.events.add(GHOST_DURATION_MS, () => {\n      this.alpha = 1;\n      // if shield is still on, keep its tint\n      if (!(this.isShielded && this.isShielded())) {\n        this.tint = 0xffffff;\n      }\n      if (this.info && this.info.hideGhost) {\n        this.info.hideGhost();\n      }\n    });\n\n    new SpoilNotification({ game: this.game, asset: 'ghost_icon', x: this.position.x, y: this.position.y })\n  }\n\n  infectDisease() {\n    this.diseaseUntil = this.game.time.now + 20000;\n    this.tint = 0x55ff55; // Toxic Green\n\n    this.game.time.events.add(20000, () => {\n      if (!this.isShielded() && !this.isGhosted() && !this.isPassWalled() && !this.isReversed()) {\n        this.tint = 0xffffff;\n      }\n    });\n\n    new SpoilNotification({ game: this.game, asset: 'disease_icon', x: this.position.x, y: this.position.y });\n  }\n\n  gainLife() {\n    this.lives = Math.min(this.maxLives || 5, (this.lives || 0) + 1);\n    if (this.info && this.info.refreshLives) this.info.refreshLives();\n    try { new SpoilNotification({ game: this.game, asset: 'placeholder_power', x: this.position.x, y: this.position.y }); } catch (_) {}\n  }\n\n  activatePassWall() {\n    this.passwallUntil = this.game.time.now + 10000;\n    // Visual: cyan tint\n    this.tint = 0x66f7ff;\n    this.game.time.events.add(10000, () => {\n      if (!this.isShielded() && !this.isGhosted() && !this.isReversed() && !this.isDiseased()) {\n        this.tint = 0xffffff;\n      }\n    });\n    if (this.info && this.info.showPassWall) this.info.showPassWall(this.passwallUntil);\n  }\n\n  isPassWalled() {\n    return this.passwallUntil && this.game.time.now < this.passwallUntil;\n  }\n\n  activateReverse() {\n    this.reverseUntil = this.game.time.now + 8000;\n    // Visual: orange tint\n    this.tint = 0xffcc66;\n    this.game.time.events.add(8000, () => {\n      if (!this.isShielded() && !this.isGhosted() && !this.isPassWalled() && !this.isDiseased()) {\n        this.tint = 0xffffff;\n      }\n    });\n    if (this.info && this.info.showReverse) this.info.showReverse(this.reverseUntil);\n  }\n\n  isReversed() {\n    return this.reverseUntil && this.game.time.now < this.reverseUntil;\n  }\n\n  defineSelf(name) {\n    let playerText = new Text({\n      game: this.game,\n      x: TILE_SIZE / 2,\n      y: -10,\n      text: `\\u272E ${name} \\u272E`,\n      style: {\n        font: '15px Arial, \"Noto Sans TC\", \"Microsoft JhengHei\", sans-serif',\n        fill: '#FFFFFF',\n          stroke: '#000000',\n          strokeThickness: 3\n      }\n    })\n\n    this.addChild(playerText);\n  }\n}\n","import { TILE_SIZE, PING } from '../utils/constants';\nimport { Text } from '../helpers/elements';\n\nexport default class EnemyPlayer extends Phaser.Sprite {\n\n  constructor({ game, id, spawn, skin, displayName, avatarParts }) {\n    super(game, spawn.x, spawn.y, 'bomberman_' + skin);\n\n    this.game = game\n    this.id = id;\n\n    this.currentPosition = spawn;\n    this.lastMoveAt = 0;\n\n    this.game.physics.arcade.enable(this);\n    this.body.setSize(20, 20, 6, 6);\n    this.body.immovable = true;\n\n    this.animations.add('up', [9, 10, 11], 15, true);\n    this.animations.add('down', [0, 1, 2], 15, true);\n    this.animations.add('right', [6, 7, 8], 15, true);\n    this.animations.add('left', [3, 4, 5], 15, true);\n\n    this.defineSelf(displayName || skin)\n\n    // cosmetics for enemies too\n    this.applyAvatarParts(avatarParts || null);\n  }\n\n  update () {\n    this.animateCosmetics();\n    // this.game.debug.body(this);\n  }\n\n  goTo(newPosition) {\n    this.lastMoveAt = this.game.time.now;\n    this._movingUntil = this.game.time.now + PING;\n\n    this.animateFace(newPosition);\n\n    this.game.add.tween(this).to(newPosition, PING, Phaser.Easing.Linear.None, true);\n  }\n\n  animateFace(newPosition) {\n    let face = 'down';\n    let diffX = newPosition.x - this.currentPosition.x;\n    let diffY = newPosition.y - this.currentPosition.y;\n\n    if (diffX < 0) {\n      face = 'left'\n    } else if (diffX > 0) {\n      face = 'right'\n    } else if (diffY < 0) {\n      face = 'up'\n    } else if (diffY > 0) {\n      face = 'down'\n    }\n\n    this.animations.play(face)\n    this.currentPosition = newPosition;\n  }\n\n  applyAvatarParts(parts) {\n    try {\n      if (this._cosmetics) {\n        for (const s of this._cosmetics) { try { s.destroy(); } catch (_) {} }\n      }\n      this._cosmetics = [];\n      if (!parts) return;\n\n      const add = (key, x, y, alpha=1) => {\n        if (!key) return;\n        const spr = this.game.add.sprite(x, y, key);\n        spr.anchor.setTo(0.5);\n        spr.scale.setTo(0.34);\n        spr.alpha = alpha;\n        spr._baseY = y;\n        this.addChild(spr);\n        this._cosmetics.push(spr);\n      };\n\n      const baseKey = (parts && parts.character) ? ('cosmetic_' + parts.character) : 'cosmetic_base';\n      add(baseKey, 16, 16, 1);\n\n      const hair = parts.hair ? ('cosmetic_' + parts.hair) : null;\n      const outfit = parts.outfit ? ('cosmetic_' + parts.outfit) : null;\n      const hat = parts.hat ? ('cosmetic_' + parts.hat) : null;\n      const face = parts.face ? ('cosmetic_' + parts.face) : null;\n      const pattern = parts.pattern ? ('cosmetic_' + parts.pattern) : null;\n\n      try { this.loadTexture('cosmetic_transparent'); } catch (_) {}\n\n      add(outfit, 16, 22, 0.98);\n      add(pattern,16, 22, 0.99);\n      add(face,   16, 14, 0.995);\n      add(hair,   16, 12, 0.999);\n      add(hat,    16, 6,  0.999);\n    } catch (_) {}\n  }\n\n  animateCosmetics() {\n    try {\n      if (!this._cosmetics || !this._cosmetics.length) return;\n      if (!this._cosBobT) this._cosBobT = 0;\n\n      // If position changed since last frame, consider moving\n      const moving = !!(this._movingUntil && this.game.time.now < this._movingUntil);\n      if (moving) this._cosBobT += (this.game.time.elapsedMS || 16);\n      else this._cosBobT = 0;\n\n      const bob = moving ? Math.sin(this._cosBobT / 90.0) * 1.6 : 0;\n      for (const s of this._cosmetics) {\n        if (!s) continue;\n        const by = (typeof s._baseY === 'number') ? s._baseY : s.y;\n        s.y = by + bob;\n      }\n    } catch (_) {}\n  }\n\n  defineSelf(name) {\n    let playerText = new Text({\n      game: this.game,\n      x: TILE_SIZE / 2,\n      y: -10,\n      text: name,\n      style: {\n        font: '14px Arial, \"Noto Sans TC\", \"Microsoft JhengHei\", sans-serif',\n        fill: '#FFFFFF',\n          stroke: '#000000',\n          strokeThickness: 3\n      }\n    })\n\n    this.addChild(playerText);\n  }\n}\n","import { TILE_SIZE, EXPLOSION_TIME } from '../utils/constants';\n\nexport default class Bomb extends Phaser.Sprite {\n\n  constructor(game, id, col, row, meta = {}) {\n    let centerCol = (col * TILE_SIZE) + TILE_SIZE / 2\n    let centerRow = (row * TILE_SIZE) + TILE_SIZE / 2\n\n    super(game, centerCol, centerRow, 'bomb_tileset');\n\n    // Visual variants by kind (no extra spritesheet needed)\n    this.kind = (meta && meta.kind) ? meta.kind : 'normal';\n    if (meta && meta.mine) this.kind = 'mine';\n    this.power = (meta && typeof meta.power === 'number') ? meta.power : null;\n\n    // Base tint\n    if (this.kind === 'sky') {\n      this.tint = 0xff5544;\n    } else if (this.kind === 'remote') {\n      this.tint = 0x66ccff;\n    } else if (this.kind === 'disease') {\n      this.tint = 0x55ff55;\n    } else if (this.kind === 'mine') {\n      this.tint = 0xffaa55;\n    }\n\n    // High-power bombs: slightly larger + faster pulse\n    try {\n      const p = (this.power == null) ? 1 : this.power;\n      if (p >= 4) {\n        this.scale.setTo(0.85);\n        this._big = true;\n      }\n    } catch (_) {}\n\n    // Optional label overlay (lightweight, helps differentiate)\n    try {\n      const mk = (txt, style) => {\n        const t = this.game.add.text(0, 0, txt, style);\n        t.anchor.setTo(0.5);\n        t.x = 0;\n        t.y = -2;\n        this.addChild(t);\n        return t;\n      };\n\n      if (this.kind === 'remote') mk('R', { font: '14px Arial', fill: '#ffffff', stroke: '#000000', strokeThickness: 3 });\n      if (this.kind === 'sky') mk('!', { font: '16px Arial', fill: '#ffffff', stroke: '#000000', strokeThickness: 3 });\n      if (this.kind === 'disease') mk('', { font: '14px Arial', fill: '#ffffff', stroke: '#000000', strokeThickness: 3 });\n      if (this.kind === 'mine') mk('M', { font: '14px Arial', fill: '#000000', stroke: '#ffffff', strokeThickness: 3 });\n      if (this.kind === 'throw') {\n        this.tint = 0xb36bff;\n        mk('T', { font: '14px Arial', fill: '#ffffff', stroke: '#000000', strokeThickness: 3 });\n      }\n\n      if (this._big) mk('P', { font: '12px Arial', fill: '#ffffff', stroke: '#000000', strokeThickness: 3 });\n    } catch (_) {}\n\n    // Kicked arrow overlay\n    this._kickedArrow = null;\n    this.setKicked = (dir) => {\n      try {\n        if (this._kickedArrow) { this._kickedArrow.destroy(); this._kickedArrow = null; }\n        const map = { left: '', right: '', up: '', down: '' };\n        const arrow = map[dir] || '';\n        const t = this.game.add.text(0, 0, arrow, { font: '18px Arial', fill: '#ffffff', stroke: '#000000', strokeThickness: 3 });\n        t.anchor.setTo(0.5);\n        t.x = 0;\n        t.y = 14;\n        this.addChild(t);\n        this._kickedArrow = t;\n        // auto-hide\n        this.game.time.events.add(900, () => {\n          try { if (this._kickedArrow) { this._kickedArrow.destroy(); this._kickedArrow = null; } } catch (_) {}\n        });\n      } catch (_) {}\n    };\n\n    // If bomb was already kicked at spawn\n    try {\n      if (meta && meta.kicked && meta.dir) this.setKicked(meta.dir);\n    } catch (_) {}\n    this.scale.setTo(0.7);\n    this.anchor.setTo(0.5);\n\n    this.game = game\n    this.id = id;\n\n    this.game.physics.arcade.enable(this);\n\n    this.game.add.tween(this.scale).to({ x: 1.2, y: 1.2 }, EXPLOSION_TIME, Phaser.Easing.Linear.None, true);\n\n    this.body.immovable = true;\n    // TODO: https://phaser.io/docs/2.4.4/Phaser.AnimationManager.html#add\n    this.animations.add('bomb', [0,1,2,3,4,5,6,7,8,9,10,11,12,13], 6, true);\n    this.animations.play('bomb');\n  }\n\n  update() {\n    // this.game.debug.body(this);\n  }\n\n}\n","import { SPOIL_SPEED, SPOIL_POWER, SPOIL_DELAY, SPOIL_SHIELD, SPOIL_REMOTE, SPOIL_KICK, SPOIL_GHOST, SPOIL_DISEASE, SPOIL_LIFE, SPOIL_PASSWALL, SPOIL_REVERSE, SPOIL_BOMB_UP, SPOIL_BOMB_PASS, SPOIL_SLOW, SPOIL_CONFUSE, SPOIL_MINE, SPOIL_THROW, SPOIL_MAGNET, TILE_SIZE } from '../utils/constants';\n\nexport default class Spoil extends Phaser.Sprite {\n\n  constructor(game, spoil) {\n\n    // UK01: spoil_tileset now contains 7 frames (0..6) matching constants\n    let frame = 0;\n    if (spoil.spoil_type === SPOIL_SPEED) frame = 0;\n    if (spoil.spoil_type === SPOIL_POWER) frame = 1;\n    if (spoil.spoil_type === SPOIL_DELAY) frame = 2;\n    if (spoil.spoil_type === SPOIL_SHIELD) frame = 3;\n    if (spoil.spoil_type === SPOIL_REMOTE) frame = 4;\n    if (spoil.spoil_type === SPOIL_KICK) frame = 5;\n    if (spoil.spoil_type === SPOIL_GHOST) frame = 6;\n    \n    // For types beyond frame range, reuse an existing frame + overlay a small icon/text.\n    if (spoil.spoil_type === SPOIL_DISEASE) frame = 2;\n    if (spoil.spoil_type === SPOIL_LIFE) frame = 1;\n    if (spoil.spoil_type === SPOIL_PASSWALL) frame = 3;\n    if (spoil.spoil_type === SPOIL_REVERSE) frame = 2;\n    if (spoil.spoil_type === SPOIL_BOMB_UP) frame = 1;\n    if (spoil.spoil_type === SPOIL_BOMB_PASS) frame = 4;\n    if (spoil.spoil_type === SPOIL_SLOW) frame = 0;\n    if (spoil.spoil_type === SPOIL_CONFUSE) frame = 2;\n    if (spoil.spoil_type === SPOIL_MINE) frame = 5;\n    if (spoil.spoil_type === SPOIL_THROW) frame = 5;\n    if (spoil.spoil_type === SPOIL_MAGNET) frame = 4;\n\n    super(game, (spoil.col * TILE_SIZE), (spoil.row * TILE_SIZE), 'spoil_tileset', frame);\n\n    if (spoil.spoil_type === SPOIL_DISEASE) {\n       this.tint = 0x55ff00; // Toxic Green tint for Disease\n       try {\n         const skull = this.game.add.sprite(0, 0, 'disease_icon');\n         skull.width = 35; skull.height = 35;\n         skull.anchor.setTo(0,0);\n         this.addChild(skull);\n       } catch(_) {}\n    }\n\n    // LIFE: simple +1 overlay\n    if (spoil.spoil_type === SPOIL_LIFE) {\n      this.tint = 0xff6bd6;\n      try {\n        const t = this.game.add.text(6, 4, '+1', { font: '16px Arial', fill: '#ffffff', stroke: '#000000', strokeThickness: 3 });\n        this.addChild(t);\n      } catch (_) {}\n    }\n\n    // PASSWALL: show \"PW\" label\n    if (spoil.spoil_type === SPOIL_PASSWALL) {\n      this.tint = 0x00e5ff;\n      try {\n        const t = this.game.add.text(3, 6, 'PW', { font: '14px Arial', fill: '#ffffff', stroke: '#000000', strokeThickness: 3 });\n        this.addChild(t);\n      } catch (_) {}\n    }\n\n    // REVERSE: show \"R\" label\n    if (spoil.spoil_type === SPOIL_REVERSE) {\n      this.tint = 0xffbb00;\n      try {\n        const t = this.game.add.text(10, 6, 'R', { font: '16px Arial', fill: '#000000', stroke: '#ffffff', strokeThickness: 3 });\n        this.addChild(t);\n      } catch (_) {}\n    }\n\n    // BOMB_UP: show \"+B\"\n    if (spoil.spoil_type === SPOIL_BOMB_UP) {\n      this.tint = 0xff6bd6;\n      try {\n        const t = this.game.add.text(2, 6, '+B', { font: '14px Arial', fill: '#ffffff', stroke: '#000000', strokeThickness: 3 });\n        this.addChild(t);\n      } catch (_) {}\n    }\n\n    // BOMB_PASS: show \"BP\"\n    if (spoil.spoil_type === SPOIL_BOMB_PASS) {\n      this.tint = 0x66ccff;\n      try {\n        const t = this.game.add.text(2, 6, 'BP', { font: '14px Arial', fill: '#ffffff', stroke: '#000000', strokeThickness: 3 });\n        this.addChild(t);\n      } catch (_) {}\n    }\n\n    // SLOW: show \"S\"\n    if (spoil.spoil_type === SPOIL_SLOW) {\n      this.tint = 0x6aa3ff;\n      try {\n        const t = this.game.add.text(10, 6, 'S', { font: '16px Arial', fill: '#ffffff', stroke: '#000000', strokeThickness: 3 });\n        this.addChild(t);\n      } catch (_) {}\n    }\n\n    // CONFUSE: show \"?\"\n    if (spoil.spoil_type === SPOIL_CONFUSE) {\n      this.tint = 0xffffff;\n      try {\n        const t = this.game.add.text(10, 6, '?', { font: '16px Arial', fill: '#000000', stroke: '#ffffff', strokeThickness: 3 });\n        this.addChild(t);\n      } catch (_) {}\n    }\n\n    // MINE: show \"M\"\n    if (spoil.spoil_type === SPOIL_MINE) {\n      this.tint = 0xffaa55;\n      try {\n        const t = this.game.add.text(8, 6, 'M', { font: '16px Arial', fill: '#000000', stroke: '#ffffff', strokeThickness: 3 });\n        this.addChild(t);\n      } catch (_) {}\n    }\n\n    // THROW: show \"T\"\n    if (spoil.spoil_type === SPOIL_THROW) {\n      this.tint = 0xb36bff;\n      try {\n        const t = this.game.add.text(10, 6, 'T', { font: '16px Arial', fill: '#ffffff', stroke: '#000000', strokeThickness: 3 });\n        this.addChild(t);\n      } catch (_) {}\n    }\n\n    // MAGNET: show \"\" (fallback to 'MG' if tofu)\n    if (spoil.spoil_type === SPOIL_MAGNET) {\n      this.tint = 0x66ccff;\n      try {\n        const t = this.game.add.text(3, 6, 'MG', { font: '14px Arial', fill: '#ffffff', stroke: '#000000', strokeThickness: 3 });\n        this.addChild(t);\n      } catch (_) {}\n    }\n\n    this.id = spoil.id\n\n    this.game.physics.arcade.enable(this);\n\n    // Light glow/pulse to make spoils more visible (mobile-friendly)\n    this.alpha = 0.92;\n    this.scale.setTo(1.0);\n    try {\n      const t1 = this.game.add.tween(this).to({ alpha: 0.62 }, 420, Phaser.Easing.Sinusoidal.InOut, true, 0, -1, true);\n      const t2 = this.game.add.tween(this.scale).to({ x: 1.08, y: 1.08 }, 520, Phaser.Easing.Sinusoidal.InOut, true, 0, -1, true);\n      // keep refs to avoid GC issues in some Phaser builds\n      this._glowTween = t1;\n      this._scaleTween = t2;\n    } catch (_) {}\n  }\n\n}\n","import { TILE_SIZE } from '../utils/constants';\n\nexport default class FireBlast extends Phaser.Sprite {\n\n  constructor(game, cell) {\n    super(game, (cell.col * TILE_SIZE), (cell.row * TILE_SIZE), cell.type, 0);\n\n    this.game = game\n\n    this.animations.add('blast', [0, 1, 2, 3, 4]);\n\n    // 15 - framerate, loop, kill_on_complete\n    this.play('blast', 15, false, true);\n\n    this.game.physics.arcade.enable(this);\n  }\n\n}\n","import { TILE_SIZE } from '../utils/constants';\n\nexport default class Bone extends Phaser.Sprite {\n\n  constructor(game, col, row) {\n    super(game, (col * TILE_SIZE), (row * TILE_SIZE), 'bone_tileset');\n  }\n\n}\n","import { findFrom, findAndDestroyFrom } from '../utils/utils';\nimport { TILESET, LAYER, TILE_SIZE, TILE_PORTAL, TILE_SPEED_FLOOR } from '../utils/constants';\n\nimport Player from '../entities/player';\nimport EnemyPlayer from '../entities/enemy_player';\nimport Bomb from '../entities/bomb';\nimport Spoil from '../entities/spoil';\nimport FireBlast from '../entities/fire_blast';\nimport Bone from '../entities/bone';\n\nclass Play extends Phaser.State {\n  init(game) {\n    this.currentGame = game\n  }\n\n  create() {\n    this.createMap();\n    this.createPlayers();\n    this.setEventHandlers();\n\n    // Keep player in view on mobile / resized canvas\n    if (this.player) {\n      this.game.camera.follow(this.player);\n    }\n\n    // hide overlays during gameplay\n    try { if (window.UK01Pending && window.UK01Pending.hide) window.UK01Pending.hide(); } catch (_) {}\n    try { if (window.UK01Menu && window.UK01Menu.hideMenu) window.UK01Menu.hideMenu(); } catch (_) {}\n\n    // Use HTML touch overlay on mobile (works even when canvas is letterboxed)\n    try { if (window.UK01Touch && window.UK01Touch.show) window.UK01Touch.show(); } catch (_) {}\n\n    // Keep Phaser touch controls disabled to avoid double-input on mobile\n    // this.createTouchControls();\n\n    // SFX / BGM\n    this.sfxPortal = this.game.add.audio('sfx_portal');\n    this.sfxSpeed = this.game.add.audio('sfx_speed');\n    this.sfxExplosion = this.game.add.audio('sfx_explosion');\n    this.sfxDeath = this.game.add.audio('sfx_death');\n\n    // Background music (loop)\n    // On mobile, playback may be blocked until a user gesture; we create the sound here\n    // and (re)start it on first joystick tap via tryUnlockAudio() in index.html.\n    try {\n      if (this.game._bgm && this.game._bgm.stop) {\n        this.game._bgm.stop();\n      }\n      this.game._bgm = this.game.add.audio('bgm_main');\n      this.game._bgm.loop = true;\n      this.game._bgm.volume = 0.28;\n      // attempt to play (may fail silently if locked)\n      this.game._bgm.play();\n    } catch (_) {}\n\n    this.game.time.events.loop(400 , this.stopAnimationLoop.bind(this));\n  }\n\n  update() {\n    // Lighting follow\n    if (this.player && this.darkness) {\n       this.darkness.x = this.player.x;\n       this.darkness.y = this.player.y;\n       \n       // Force Z-order (Objects pop out of darkness)\n       this.game.world.bringToTop(this.darkness);\n       this.game.world.bringToTop(this.spoils);\n       this.game.world.bringToTop(this.bombs);\n       this.game.world.bringToTop(this.bones);\n       this.game.world.bringToTop(this.blasts); // Fire is bright\n       this.game.world.bringToTop(this.enemies);\n       if (this.player) this.game.world.bringToTop(this.player);\n    }\n\n    this.refreshGhostCollision();\n\n    this.game.physics.arcade.collide(this.player, this.blockLayer);\n    this.game.physics.arcade.collide(this.player, this.enemies);\n    // Bomb collision: allow BombPass and mines to be passable.\n    this.game.physics.arcade.collide(\n      this.player,\n      this.bombs,\n      this.onPlayerVsBomb,\n      (player, bomb) => {\n        try {\n          if (player && player.hasBombPass) return false;\n          if (bomb && bomb.kind === 'mine') return false;\n        } catch (_) {}\n        return true;\n      },\n      this\n    );\n\n    this.game.physics.arcade.overlap(this.player, this.spoils, this.onPlayerVsSpoil, null, this);\n    this.game.physics.arcade.overlap(this.player, this.blasts, this.onPlayerVsBlast, null, this);\n\n    this.handleSpecialTiles();\n    this.handleMagnet();\n  }\n\n  createMap() {\n    this.map = this.add.tilemap(this.currentGame.map_name);\n\n    this.map.addTilesetImage(TILESET);\n\n    // Some maps may have different layer names. Prefer configured LAYER, but fall back to the first layer.\n    this.blockLayer = this.map.createLayer(LAYER);\n    if (!this.blockLayer) {\n      try { console.warn('createLayer failed for', LAYER, 'falling back to layer 0'); } catch (_) {}\n      this.blockLayer = this.map.createLayer(0);\n    }\n\n    // If still missing, abort early to avoid hard crash.\n    if (!this.blockLayer) {\n      throw new Error('Tilemap layer not found: ' + String(LAYER));\n    }\n\n    this.blockLayer.resizeWorld();\n\n    this.baseCollisionTiles = (this.blockLayer.layer.properties.collisionTiles || []).slice();\n    this.wallTileIndex = this.blockLayer.layer.properties.wall;\n    this.balkTileIndex = this.blockLayer.layer.properties.balk;\n\n    this.map.setCollision(this.baseCollisionTiles, true, this.blockLayer);\n    this._ghostCollisionEnabled = false;\n\n    // Special tiles cache\n    this.portalCells = [];\n    this.speedCells = new Set();\n\n    // Visual overlays (magic style placeholder)\n    this.specialFx = this.game.add.group();\n\n    const layer = this.map.layers[0];\n    const w = layer.width;\n    const h = layer.height;\n    const data = layer.data;\n\n    for (let r = 0; r < h; r++) {\n      for (let c = 0; c < w; c++) {\n        const tile = data[r][c];\n        if (!tile) continue;\n        const idx = tile.index;\n\n        // Portal tile id must NOT conflict with balk (destructible) tile id.\n        // cold_map uses balk=2, which would otherwise create \"too many portals\".\n        if (idx === TILE_PORTAL && idx !== this.balkTileIndex) {\n          this.portalCells.push({ col: c, row: r });\n        } else if (idx === TILE_SPEED_FLOOR) {\n          this.speedCells.add(`${c},${r}`);\n        }\n      }\n    }\n\n    // Special tiles visuals (animated spritesheets)\n    // NOTE: We keep them as a separate group so they sit above the map.\n    for (const p of this.portalCells) {\n      const x = p.col * TILE_SIZE;\n      const y = p.row * TILE_SIZE;\n      const s = this.game.add.sprite(x, y, 'portal_fx');\n      s.alpha = 0.95;\n      s.blendMode = Phaser.blendModes.ADD;\n      s.animations.add('spin', [0, 1, 2, 3, 4, 5], 10, true);\n      s.animations.play('spin');\n      this.specialFx.add(s);\n    }\n\n    for (const key of this.speedCells) {\n      const [c, r] = key.split(',').map(Number);\n      const x = c * TILE_SIZE;\n      const y = r * TILE_SIZE;\n      const s = this.game.add.sprite(x, y, 'speed_fx');\n      s.alpha = 0.75;\n      s.animations.add('flow', [0, 1, 2, 3, 4, 5], 12, true);\n      s.animations.play('flow');\n      this.specialFx.add(s);\n    }\n\n    this.player  = null;\n    this.bones   = this.game.add.group();\n    this.bombs   = this.game.add.group();\n    this.spoils  = this.game.add.group();\n    this.blasts  = this.game.add.group();\n    this.enemies = this.game.add.group();\n\n    this.game.physics.arcade.enable(this.blockLayer);\n\n    // --- Lighting (optional) ---\n    // The darkness overlay can make the screen look like a \"black film\".\n    // Default: OFF. Enable with URL param ?dark=1\n    this.darkness = null;\n    try {\n      const enableDark = (typeof window !== 'undefined') && window.location && /(?:\\?|&)dark=1(?:&|$)/.test(window.location.search || '');\n      if (enableDark) {\n        this.darkness = this.game.add.sprite(0, 0, 'light_mask');\n        this.darkness.anchor.setTo(0.5);\n        this.darkness.width = 1600;\n        this.darkness.height = 1600;\n        this.darkness.alpha = 0.82;\n        this.darkness.blendMode = Phaser.blendModes.MULTIPLY;\n      }\n    } catch (_) {}\n  }\n\n  createPlayers() {\n    const all = Object.values(this.currentGame.players || {});\n\n    // Prefer socket id match\n    let local = all.find(p => p && p.id === clientSocket.id);\n\n    // Fallback: match by authenticated userId (useful if socket id changed)\n    if (!local) {\n      try {\n        const uid = window.currentUser && window.currentUser.id;\n        if (uid) {\n          local = all.find(p => p && p.userId && p.userId === uid);\n        }\n      } catch (_) {}\n    }\n\n    for (let player of all) {\n      if (!player) continue;\n      let setup = {\n        game:   this.game,\n        id:     player.id,\n        spawn:  player.spawn,\n        skin:   player.skin,\n        displayName: player.displayName || player.skin,\n        avatarParts: player.avatarParts || null,\n      }\n\n      if ((local && player === local) || player.id === clientSocket.id) {\n        this.player = new Player(setup);\n      } else {\n        this.enemies.add(new EnemyPlayer(setup))\n      }\n    }\n\n    // If still not found (anonymous + mismatch), pick first non-bot as local to avoid a blank screen\n    if (!this.player && all.length) {\n      const first = all.find(p => p && !(typeof p.id === 'string' && p.id.startsWith('bot:'))) || all[0];\n      if (first) {\n        this.player = new Player({ game: this.game, id: first.id, spawn: first.spawn, skin: first.skin, avatarParts: first.avatarParts || null });\n      }\n    }\n  }\n\n  setEventHandlers() {\n    clientSocket.on('move player', this.onMovePlayer.bind(this));\n    clientSocket.on('player win', this.onPlayerWin.bind(this));\n    clientSocket.on('show bomb', this.onShowBomb.bind(this));\n    clientSocket.on('detonate bomb', this.onDetonateBomb.bind(this));\n    clientSocket.on('move bomb', this.onMoveBomb.bind(this));\n    clientSocket.on('spoil was picked', this.onSpoilWasPicked.bind(this));\n    clientSocket.on('show bones', this.onShowBones.bind(this));\n    clientSocket.on('player disconnect', this.onPlayerDisconnect.bind(this));\n    clientSocket.on('sudden death tiles', this.onSuddenDeathTiles.bind(this));\n    clientSocket.on('spawn player', this.onSpawnPlayer.bind(this));\n    clientSocket.on('match summary', this.onMatchSummary.bind(this));\n    clientSocket.on('player hit', this.onPlayerHit.bind(this));\n  }\n\n  onPlayerHit({ player_id, lives }) {\n    // Visual feedback for taking damage but surviving\n    const p = (this.player && this.player.id === player_id) ? this.player : findFrom(player_id, this.enemies);\n    if (!p) return;\n\n    // Update lives for local HUD\n    try {\n      if (this.player && this.player.id === player_id && typeof lives === 'number') {\n        this.player.lives = lives;\n        if (this.player.info && this.player.info.refreshLives) this.player.info.refreshLives();\n      }\n    } catch (_) {}\n\n    // Flash effect\n    if (p.flickerTimer) { this.game.time.events.remove(p.flickerTimer); }\n    p.alpha = 1;\n    let count = 0;\n    p.flickerTimer = this.game.time.events.loop(100, () => {\n      p.alpha = (p.alpha === 1) ? 0.3 : 1;\n      count++;\n      if (count > 28) { // ~3s\n        this.game.time.events.remove(p.flickerTimer);\n        p.alpha = 1;\n      }\n    });\n\n    // Optional: show lives text above head?\n    // We don't have UI for it yet, but blinking indicates damage.\n    try { if (this.sfxDeath) this.sfxDeath.play(); } catch (_) {}\n  }\n\n  onPlayerVsSpoil(player, spoil) {\n    clientSocket.emit('pick up spoil', { spoil_id: spoil.id });\n    spoil.kill();\n  }\n\n  onPlayerVsBlast(player, blast) {\n    if (!player.alive) return;\n    // Shield powerup: brief invulnerability\n    if (player.isShielded && player.isShielded()) return;\n\n    // Do NOT play death sound here, wait for server to confirm hit/death\n    // try { if (this.sfxDeath) this.sfxDeath.play(); } catch (_) {}\n\n    // Throttle reporting to avoid spamming \"player died\" for every blast tile overlap\n    const now = this.game.time.now;\n    if (player._lastDeathReport && now - player._lastDeathReport < 500) return;\n    player._lastDeathReport = now;\n\n    clientSocket.emit('player died', { col: player.currentCol(), row: player.currentRow() });\n    \n    // Do NOT kill local player immediately. Wait for server 'show bones' or 'player hit'.\n    // player.becomesDead() \n  }\n\n  onMovePlayer({ player_id, x, y }) {\n    let enemy = findFrom(player_id, this.enemies);\n    if (!enemy) { return }\n\n    enemy.goTo({ x: x, y: y })\n  }\n\n  onPlayerVsBomb(player, bomb) {\n    if (!player || !bomb) return;\n    if (!player.hasKick) return;\n\n    // Determine movement direction intent (keyboard + touch)\n    const left  = player.leftKey.isDown  || (player.aKey && player.aKey.isDown) || player.touchLeft;\n    const right = player.rightKey.isDown || (player.dKey && player.dKey.isDown) || player.touchRight;\n    const up    = player.upKey.isDown    || (player.wKey && player.wKey.isDown) || player.touchUp;\n    const down  = player.downKey.isDown  || (player.sKey && player.sKey.isDown) || player.touchDown;\n\n    let dir = null;\n    if (left) dir = 'left';\n    else if (right) dir = 'right';\n    else if (up) dir = 'up';\n    else if (down) dir = 'down';\n\n    if (!dir) return;\n\n    // Throttle: avoid spamming server every physics tick\n    const now = this.game.time.now;\n    if (!player._lastKickAt) player._lastKickAt = 0;\n    if (now - player._lastKickAt < 110) return;\n    player._lastKickAt = now;\n\n    clientSocket.emit('kick bomb', { bomb_id: bomb.id, dir });\n  }\n\n  onMoveBomb({ bomb_id, col, row, kicked, dir }) {\n    const b = findFrom(bomb_id, this.bombs);\n    if (!b) return;\n\n    const x = (col * TILE_SIZE) + TILE_SIZE / 2;\n    const y = (row * TILE_SIZE) + TILE_SIZE / 2;\n    b.x = x;\n    b.y = y;\n    if (b.body) {\n      b.body.reset(x, y);\n    }\n\n    // Visual: show kicked arrow briefly\n    try {\n      if (kicked && b.setKicked) b.setKicked(dir);\n    } catch (_) {}\n  }\n\n  stopAnimationLoop() {\n    for (let enemy of this.enemies.children) {\n      if (enemy.lastMoveAt < this.game.time.now - 200) {\n        enemy.animations.stop();\n      }\n    }\n  }\n\n  createTouchControls() {\n    if (!this.player) return;\n\n    // Only show on touch-capable devices (Phaser detection can be flaky on some mobile browsers)\n    const isTouchCapable = (\n      (this.game.device && (this.game.device.touch || this.game.device.iOS || this.game.device.android)) ||\n      (typeof window !== 'undefined' && ('ontouchstart' in window)) ||\n      (typeof navigator !== 'undefined' && (navigator.maxTouchPoints > 0))\n    );\n    if (!isTouchCapable) return;\n\n    const g = this.game.add.group();\n    g.fixedToCamera = true;\n    g.cameraOffset.setTo(0, 0);\n\n    const mkBtn = ({ x, y, r = 44, label, onDown, onUp, fill = 0x111111, alpha = 0.35, stroke = 0xffffff, strokeAlpha = 0.22 }) => {\n      const btn = this.game.add.graphics(0, 0);\n      btn.beginFill(fill, alpha);\n      btn.lineStyle(3, stroke, strokeAlpha);\n      btn.drawCircle(0, 0, r * 2);\n      btn.endFill();\n      btn.x = x;\n      btn.y = y;\n\n      const t = this.game.add.text(0, 0, label, { font: '26px Arial', fill: '#ffffff' });\n      t.anchor.setTo(0.5);\n      btn.addChild(t);\n\n      btn.inputEnabled = true;\n      btn.events.onInputDown.add(() => onDown && onDown());\n      const up = () => onUp && onUp();\n      btn.events.onInputUp.add(up);\n      btn.events.onInputOut.add(up);\n\n      g.add(btn);\n      return btn;\n    };\n\n    const w = this.game.width;\n    const h = this.game.height;\n\n    // iOS/Android safe-area padding (home indicator / browser UI)\n    const cssSafeBottom = (() => {\n      try {\n        const v = getComputedStyle(document.documentElement).getPropertyValue('env(safe-area-inset-bottom)');\n        const n = parseInt((v || '0').toString().replace('px', '').trim(), 10);\n        return Number.isFinite(n) ? n : 0;\n      } catch (_) {\n        return 0;\n      }\n    })();\n\n    const padBottom = Math.max(28, cssSafeBottom + 18);\n\n    // Scale controls a bit based on screen size\n    const s = Math.max(0.85, Math.min(1.15, Math.min(w, h) / 700));\n\n    // Virtual joystick (4-direction snap)\n    const baseX = 125 * s;\n    const baseY = h - (185 * s) - padBottom;\n    const baseR = 70 * s;\n    const knobR = 36 * s;\n\n    const base = this.game.add.graphics(0, 0);\n    base.beginFill(0x111111, 0.22);\n    base.lineStyle(3, 0xffffff, 0.18);\n    base.drawCircle(0, 0, baseR * 2);\n    base.endFill();\n    base.x = baseX;\n    base.y = baseY;\n    base.inputEnabled = true;\n    base.input.enableDrag(false);\n    g.add(base);\n\n    const knob = this.game.add.graphics(0, 0);\n    knob.beginFill(0x00e5ff, 0.18);\n    knob.lineStyle(3, 0x00e5ff, 0.25);\n    knob.drawCircle(0, 0, knobR * 2);\n    knob.endFill();\n    knob.x = baseX;\n    knob.y = baseY;\n    g.add(knob);\n\n    const resetDir = () => {\n      this.player.touchLeft = this.player.touchRight = this.player.touchUp = this.player.touchDown = false;\n    };\n\n    const setDirFromVector = (dx, dy) => {\n      resetDir();\n      const dead = 14;\n      if (Math.abs(dx) < dead && Math.abs(dy) < dead) {\n        knob.x = baseX;\n        knob.y = baseY;\n        return;\n      }\n\n      // snap to 4 directions\n      if (Math.abs(dx) > Math.abs(dy)) {\n        if (dx > 0) this.player.touchRight = true;\n        else this.player.touchLeft = true;\n        knob.x = baseX + Math.max(-baseR + knobR, Math.min(baseR - knobR, dx));\n        knob.y = baseY;\n      } else {\n        if (dy > 0) this.player.touchDown = true;\n        else this.player.touchUp = true;\n        knob.x = baseX;\n        knob.y = baseY + Math.max(-baseR + knobR, Math.min(baseR - knobR, dy));\n      }\n    };\n\n    const onPointer = (pointer) => {\n      const dx = pointer.x - baseX;\n      const dy = pointer.y - baseY;\n      const len = Math.sqrt(dx * dx + dy * dy) || 1;\n      const max = baseR - knobR;\n      const clamped = Math.min(max, len);\n      const ndx = (dx / len) * clamped;\n      const ndy = (dy / len) * clamped;\n      setDirFromVector(ndx, ndy);\n    };\n\n    base.events.onInputDown.add((sprite, pointer) => onPointer(pointer));\n    base.events.onInputUp.add(() => { resetDir(); knob.x = baseX; knob.y = baseY; });\n    base.events.onInputOut.add(() => { resetDir(); knob.x = baseX; knob.y = baseY; });\n\n    // Track drag/move globally while pressed\n    this.game.input.addMoveCallback((pointer) => {\n      if (!pointer.isDown) return;\n      onPointer(pointer);\n    }, this);\n\n    // Bomb button (right side)\n    mkBtn({\n      x: w - (115 * s),\n      y: h - (165 * s) - padBottom,\n      r: 54 * s,\n      label: '',\n      fill: 0x7a1cff,\n      alpha: 0.32,\n      stroke: 0x00e5ff,\n      strokeAlpha: 0.35,\n      onDown: () => (this.player.touchBomb = true),\n      onUp: () => (this.player.touchBomb = false),\n    });\n\n    // Reposition on resize (RESIZE scale mode)\n    this.game.scale.onSizeChange.add(() => {\n      const w2 = this.game.width;\n      const h2 = this.game.height;\n      // update camera-fixed positions by moving the whole group\n      // easiest: clear & recreate\n      g.destroy(true);\n      this.createTouchControls();\n    });\n  }\n\n  onSuddenDeathTiles({ level, tiles }) {\n    if (!tiles || !tiles.length) return;\n\n    // Visual: place walls on map; keep collision as-is (walls are already collidable)\n    const wallIdx = this.wallTileIndex;\n    for (const t of tiles) {\n      try {\n        this.map.putTile(wallIdx, t.col, t.row, this.blockLayer);\n      } catch (_) {}\n    }\n\n    // Optional: show a tiny hint\n    try {\n      if (!this._sdText) {\n        this._sdText = this.game.add.text(10, 10, '', { font: '16px Arial', fill: '#ffdf7a', stroke: '#000', strokeThickness: 3 });\n        this._sdText.fixedToCamera = true;\n      }\n      this._sdText.text = `SUDDEN DEATH Lv.${level}`;\n      this.game.time.events.add(1200, () => { try { if (this._sdText) this._sdText.text = ''; } catch (_) {} });\n    } catch (_) {}\n  }\n\n  refreshGhostCollision() {\n    if (!this.player) return;\n\n    const ghost = (this.player.isGhosted && this.player.isGhosted()) || (this.player.isPassWalled && this.player.isPassWalled());\n    if (ghost === this._ghostCollisionEnabled) return;\n\n    // Ghost: phase through destructible blocks (\"balk\") only.\n    // We keep walls solid.\n    this._ghostCollisionEnabled = ghost;\n\n    if (ghost) {\n      this.map.setCollision([this.wallTileIndex], true, this.blockLayer);\n      if (this.balkTileIndex != null) {\n        this.map.setCollision([this.balkTileIndex], false, this.blockLayer);\n      }\n    } else {\n      this.map.setCollision(this.baseCollisionTiles, true, this.blockLayer);\n    }\n  }\n\n  handleSpecialTiles() {\n    if (!this.player) return;\n\n    const col = Math.floor(this.player.body.position.x / TILE_SIZE);\n    const row = Math.floor(this.player.body.position.y / TILE_SIZE);\n\n    // Speed floor\n    const onSpeed = this.speedCells.has(`${col},${row}`);\n    this.player.tileSpeedMultiplier = onSpeed ? 1.65 : 1.0;\n\n    if (!this.player._wasOnSpeed) this.player._wasOnSpeed = false;\n    if (onSpeed && !this.player._wasOnSpeed) {\n      try { if (this.sfxSpeed) this.sfxSpeed.play(); } catch (_) {}\n    }\n    this.player._wasOnSpeed = onSpeed;\n\n    // Portal (pair portals in order: 0<->1, 2<->3, ...)\n    if (this.portalCells.length >= 2) {\n      const now = this.game.time.now;\n      if (!this.player._lastPortalAt) this.player._lastPortalAt = 0;\n\n      const isBlockedCell = (c, r) => {\n        try {\n          const t = this.map.getTile(c, r, this.blockLayer);\n          if (!t) return false;\n          // Treat walls/balks as blocked\n          if (t.index === this.wallTileIndex) return true;\n          if (this.balkTileIndex != null && t.index === this.balkTileIndex) return true;\n          // Some maps may mark additional collision tiles\n          if (t.collides) return true;\n          return false;\n        } catch (_) {\n          return false;\n        }\n      };\n\n      const hasBombAt = (c, r) => {\n        try {\n          return (this.bombs && this.bombs.children || []).some(b => b && b.col === c && b.row === r);\n        } catch (_) { return false; }\n      };\n\n      const findSafeLanding = (c0, r0) => {\n        // Prefer exact target, else search nearby in small radius\n        const tryCell = (c, r) => {\n          if (isBlockedCell(c, r)) return null;\n          if (hasBombAt(c, r)) return null;\n          return { col: c, row: r };\n        };\n        let ok = tryCell(c0, r0);\n        if (ok) return ok;\n\n        for (let rad = 1; rad <= 2; rad++) {\n          for (let dr = -rad; dr <= rad; dr++) {\n            for (let dc = -rad; dc <= rad; dc++) {\n              const c = c0 + dc;\n              const r = r0 + dr;\n              ok = tryCell(c, r);\n              if (ok) return ok;\n            }\n          }\n        }\n        return null;\n      };\n\n      const portalIndex = this.portalCells.findIndex(p => p.col === col && p.row === row);\n      if (portalIndex >= 0 && now - this.player._lastPortalAt > 950) {\n        const pairIndex = (portalIndex % 2 === 0) ? portalIndex + 1 : portalIndex - 1;\n        const target = this.portalCells[pairIndex];\n        if (target) {\n          const landing = findSafeLanding(target.col, target.row);\n          if (landing) {\n            // Teleport to tile top-left (sprite origin). Keep body fully inside the tile.\n            this.player.x = landing.col * TILE_SIZE;\n            this.player.y = landing.row * TILE_SIZE;\n            this.player.body.velocity.set(0);\n            this.player.body.reset(this.player.x, this.player.y);\n            this.player.prevPosition = { x: this.player.x, y: this.player.y };\n            this.player._lastPortalAt = now;\n\n            try { if (this.sfxPortal) this.sfxPortal.play(); } catch (_) {}\n          }\n        }\n      }\n    }\n  }\n\n  handleMagnet() {\n    if (!this.player || !this.spoils) return;\n    if (!(this.player.isMagnetOn && this.player.isMagnetOn())) return;\n\n    const px = this.player.x;\n    const py = this.player.y;\n    const radius = 220;\n\n    for (const s of (this.spoils.children || [])) {\n      if (!s || !s.alive) continue;\n      const dx = px - s.x;\n      const dy = py - s.y;\n      const dist = Math.sqrt(dx*dx + dy*dy) || 1;\n      if (dist > radius) continue;\n\n      const pull = (radius - dist) / radius;\n      s.x += (dx / dist) * (1.4 + 2.8 * pull);\n      s.y += (dy / dist) * (1.4 + 2.8 * pull);\n\n      try { if (s.body) s.body.reset(s.x, s.y); } catch (_) {}\n    }\n  }\n\n  onShowBomb({ bomb_id, col, row, kind, owner_id, power, kicked, dir }) {\n    this.bombs.add(new Bomb(this.game, bomb_id, col, row, { kind, owner_id, power, kicked, dir }));\n  }\n\n  onDetonateBomb({ bomb_id, blastedCells }) {\n    // Remove Bomb:\n    findAndDestroyFrom(bomb_id, this.bombs)\n\n    try { if (this.sfxExplosion) this.sfxExplosion.play(); } catch (_) {}\n\n    // Render Blast:\n    for (let cell of blastedCells) {\n      this.blasts.add(new FireBlast(this.game, cell));\n    };\n\n    // Destroy Tiles:\n    for (let cell of blastedCells) {\n      if (!cell.destroyed) { continue }\n\n      this.map.putTile(this.blockLayer.layer.properties.empty, cell.col, cell.row, this.blockLayer);\n    };\n\n    // Add Spoils:\n    for (let cell of blastedCells) {\n      if (!cell.destroyed) { continue }\n      if (!cell.spoil) { continue }\n\n      this.spoils.add(new Spoil(this.game, cell.spoil));\n    };\n  }\n\n  onSpoilWasPicked({ player_id, spoil_id, spoil_type }){\n    if (player_id === this.player.id){\n      this.player.pickSpoil(spoil_type)\n    }\n\n    findAndDestroyFrom(spoil_id, this.spoils)\n  }\n\n  onShowBones({ player_id, col, row }) {\n    this.bones.add(new Bone(this.game, col, row));\n\n    findAndDestroyFrom(player_id, this.enemies)\n  }\n\n  onMatchSummary({ summary, reason }) {\n    try { if (window.UK01Touch && window.UK01Touch.hide) window.UK01Touch.hide(); } catch (_) {}\n    try { clientSocket.emit('leave game'); } catch (_) {}\n\n    this.state.start('Win', true, false, { mode: 'horde', summary, reason: reason || 'horde_end' });\n  }\n\n  onPlayerWin(payload) {\n    try { if (window.UK01Touch && window.UK01Touch.hide) window.UK01Touch.hide(); } catch (_) {}\n    clientSocket.emit('leave game');\n\n    // Backward compatible: server may send a skin string or { skin, player_id, reason }\n    const winner_skin = (payload && payload.skin) ? payload.skin : payload;\n    const reason = (payload && payload.reason) ? payload.reason : null;\n\n    this.state.start('Win', true, false, { skin: winner_skin, reason });\n  }\n\n  onPlayerDisconnect({ player_id }) {\n    findAndDestroyFrom(player_id, this.enemies);\n\n    if (this.enemies.children.length >= 1) { return }\n\n    this.onPlayerWin()\n  }\n\n  onSpawnPlayer({ player }) {\n    try {\n      if (!player || !player.id) return;\n      // Don't respawn local player\n      if (player.id === clientSocket.id) return;\n\n      // If already exists, skip\n      const exists = findFrom(player.id, this.enemies);\n      if (exists) return;\n\n      const setup = {\n        game: this.game,\n        id: player.id,\n        spawn: player.spawn,\n        skin: player.skin,\n        displayName: player.displayName || player.skin,\n        avatarParts: player.avatarParts || null,\n      };\n\n      this.enemies.add(new EnemyPlayer(setup));\n    } catch (_) {}\n  }\n}\n\nexport default Play;\n","import { Text } from '../helpers/elements';\n\nclass Win extends Phaser.State {\n\n  init(payload) {\n    // payload may be a string skin or { skin, reason, summary, mode }\n    if (payload && typeof payload === 'object') {\n      this.skin = payload.skin;\n      this.reason = payload.reason;\n      this.summary = payload.summary || null;\n      this.mode = payload.mode || null;\n    } else {\n      this.skin = payload;\n      this.reason = null;\n      this.summary = null;\n      this.mode = null;\n    }\n  }\n\n  create() {\n    // Hide touch overlay on end screen\n    try { if (window.UK01Touch && window.UK01Touch.hide) window.UK01Touch.hide(); } catch (_) {}\n\n    // Stop BGM on end screen\n    try {\n      const g = this.game;\n      if (g && g._bgm && g._bgm.stop) g._bgm.stop();\n    } catch (_) {}\n\n    new Text({\n      game: this.game,\n      x: this.game.world.centerX,\n      y: this.game.world.centerY,\n      text: this.winnerText(),\n      style: {\n        font: '30px Arial, \"Noto Sans TC\", \"Microsoft JhengHei\", sans-serif',\n        fill: '#FFFFFF'\n      }\n    })\n\n    // Mobile-friendly: tap anywhere to return\n    try {\n      this.game.input.onTap.addOnce(() => this.returnToMenu());\n    } catch (_) {}\n\n    // Also allow pointer click\n    try {\n      this.game.input.onDown.addOnce(() => this.returnToMenu());\n    } catch (_) {}\n\n    // Auto return after a short delay (avoid getting stuck)\n    try {\n      this.game.time.events.add(3500, () => this.returnToMenu());\n    } catch (_) {}\n  }\n\n  update() {\n    if( this.game.input.keyboard.isDown(Phaser.Keyboard.ENTER) ) {\n      this.returnToMenu();\n    }\n  }\n\n  returnToMenu() {\n    this.state.start('Menu');\n  }\n\n  winnerText() {\n    if (this.summary && (this.summary.mode === 'horde' || this.mode === 'horde')) {\n      const s = this.summary;\n      const dur = (s.durationMs != null) ? (s.durationMs / 1000).toFixed(1) : null;\n      const teamKills = (s.teamKills != null) ? s.teamKills : 0;\n      const top = (s.perPlayer && s.perPlayer[0]) ? s.perPlayer[0] : null;\n      const topLine = top ? `${top.displayName || top.skin}: ${(top.survivalMs/1000).toFixed(1)}s, ${top.kills} kills` : '';\n      return `HORDE ended. Time: ${dur || '?'}s  Team Kills: ${teamKills}\\n${topLine}\\nTap to return to main menu.`;\n    }\n\n    if (this.skin) {\n      const why = this.reason ? ` (reason: ${this.reason})` : '';\n      return `Player: \"${this.skin}\" won!${why} Tap to return to main menu.`\n    }\n\n    return 'Opponent left! Tap to return to main menu.'\n  }\n}\n\nexport default Win;\n","import Boot from './states/boot';\nimport Preload from './states/preload';\nimport Menu from './states/menu';\nimport SelectMap from './states/select_map';\nimport PendingGame from './states/pending_game';\nimport Play from './states/play';\nimport Win from './states/win';\n\nclass Game extends Phaser.Game {\n  constructor() {\n    // Use a fixed logical resolution; CSS + ScaleManager will scale to fit mobile screens.\n    // Map size is 28x18 tiles at 35px => 980x630.\n    super(980, 630, Phaser.AUTO, 'game-container');\n\n    // Tell Phaser to use setTimeOut even if RAF(request animation frame) is available.\n    this.config['forceSetTimeOut'] = true\n\n    this.state.add('Boot',         Boot);\n    this.state.add('Preload',      Preload);\n    this.state.add('Menu',         Menu);\n    this.state.add('SelectMap',    SelectMap);\n    this.state.add('PendingGame',  PendingGame);\n    this.state.add('Play',         Play);\n    this.state.add('Win',          Win);\n\n    this.state.start('Boot');\n  }\n}\n\n// keep a reference for HTML overlay to control states\nwindow.__phaserGame = new Game();\n"],"names":["Text","Phaser","constructor","game","x","y","text","style","super","this","anchor","setTo","add","existing","Button","GameSlots","Group","availableGames","callback","callbackContext","yOffset","availableGame","gameBox","Image","button","width","bind","game_id","id","name","addChild","destroy","callAll","PlayerSlots","max_players","players","asset_empty","asset_player","xOffset","i","slotBox","slotName","_player","skin","label","displayName","height","SpoilNotification","asset","picture","tween","to","alpha","onComplete","finish","start","Boot","State","create","stage","disableVisibilityChange","scale","scaleMode","ScaleManager","SHOW_ALL","pageAlignHorizontally","pageAlignVertically","refresh","_","window","addEventListener","loadingText","world","centerX","centerY","font","fill","startNext","state","document","fonts","load","Promise","all","then","catch","sound","mute","input","onDown","addOnce","context","resume","unlock","Preload","preload","onFileError","key","file","UK01Log","url","onFileComplete","progress","UK01Loading","set","onLoadComplete","image","spritesheet","tilemap","Tilemap","TILED_JSON","audio","cos","p","done","Menu","init","slotsWithGame","clientSocket","on","displayPendingGames","UK01Menu","showMenu","emit","update","hostGameAction","joinGameAction","stroke","strokeThickness","TILE_SIZE","LAYER","AVAILABLE_MAPS","SelectMap","slider","phaseSlider","showMaps","confirmStageSelection","map_name","getCurrentIndex","joinToNewGame","payload","error","alert","message","PendingGame","slotsWithPlayer","displayGameInfo","launchGame","UK01Pending","show","hideMenu","gameTitle","setAICount","n","aiCount","Math","max","min","aiText","count","setAIDifficulty","difficulty","aiDifficulty","aiDiffText","current_game","Object","values","updateFromGame","leaveGameAction","startGameAction","findFrom","entities","entity","children","findAndDestroyFrom","Info","player","align","redStyle","hud","group","fixedToCamera","bootsIcon","speedText","speedLabel","powerIcon","powerText","powerLabel","delayIcon","delayText","delayLabel","lifeIcon","lifeText","lifeLabel","bombIcon","bombText","bombLabel","ghostIcon","ghostText","visible","_ghostTimer","deadText","refreshStatistic","refreshLives","refreshBombs","showGhost","ghostUntilMs","time","events","remove","tick","left","now","toFixed","hideGhost","loop","showDeadInfo","speed","power","delay","lives","maxBombs","mineAmmo","Player","Sprite","spawn","avatarParts","prevPosition","tileSpeedMultiplier","_lastBombTime","shieldUntil","ghostUntil","hasRemote","hasKick","diseaseUntil","passwallUntil","reverseUntil","slowUntil","confuseUntil","maxLives","hasBombPass","hasThrow","magnetUntil","physics","arcade","enable","body","setSize","touchLeft","touchRight","touchUp","touchDown","touchBomb","positionUpdaterLoop","animations","info","defineKeyboard","defineSelf","applyAvatarParts","alive","handleMoves","handleBombs","animateCosmetics","upKey","keyboard","addKey","Keyboard","UP","downKey","DOWN","leftKey","LEFT","rightKey","RIGHT","wKey","W","aKey","A","sKey","S","dKey","D","spaceKey","SPACEBAR","velocity","animationsArray","effectiveSpeed","isSlowed","isDown","right","up","down","isReversed","l","u","isConfused","push","_lastDir","currentAnimation","play","stop","bombDown","_bombHeld","_bombDownAt","_bombLongTriggered","dir","range","col","currentCol","row","currentRow","floor","position","newPosition","becomesDead","kill","pickSpoil","spoil_type","increaseSpeed","increasePower","increaseDelay","activateShield","enableRemote","enableKick","activateGhost","infectDisease","gainLife","activatePassWall","activateReverse","increaseBombCapacity","enableBombPass","activateSlow","activateConfuse","gainMine","enableThrow","activateMagnet","isShielded","isGhosted","isDiseased","tint","isPassWalled","isMagnetOn","parts","_cosmetics","s","spr","sprite","_baseY","character","hair","outfit","hat","face","pattern","loadTexture","length","moving","abs","_cosBobT","elapsedMS","bob","sin","by","showPassWall","showReverse","playerText","EnemyPlayer","currentPosition","lastMoveAt","immovable","goTo","_movingUntil","animateFace","Easing","Linear","None","diffX","diffY","Bomb","meta","kind","mine","_big","mk","txt","t","_kickedArrow","setKicked","arrow","kicked","Spoil","spoil","frame","skull","t1","Sinusoidal","InOut","t2","_glowTween","_scaleTween","FireBlast","cell","type","Bone","Play","currentGame","createMap","createPlayers","setEventHandlers","camera","follow","hide","UK01Touch","sfxPortal","sfxSpeed","sfxExplosion","sfxDeath","_bgm","volume","stopAnimationLoop","darkness","bringToTop","spoils","bombs","bones","blasts","enemies","refreshGhostCollision","collide","blockLayer","onPlayerVsBomb","bomb","overlap","onPlayerVsSpoil","onPlayerVsBlast","handleSpecialTiles","handleMagnet","map","addTilesetImage","createLayer","console","warn","Error","String","resizeWorld","baseCollisionTiles","layer","properties","collisionTiles","slice","wallTileIndex","wall","balkTileIndex","balk","setCollision","_ghostCollisionEnabled","portalCells","speedCells","Set","specialFx","layers","w","h","data","r","c","tile","idx","index","blendMode","blendModes","ADD","split","Number","location","test","search","MULTIPLY","local","find","uid","currentUser","userId","setup","first","startsWith","onMovePlayer","onPlayerWin","onShowBomb","onDetonateBomb","onMoveBomb","onSpoilWasPicked","onShowBones","onPlayerDisconnect","onSuddenDeathTiles","onSpawnPlayer","onMatchSummary","onPlayerHit","player_id","flickerTimer","spoil_id","blast","_lastDeathReport","enemy","_lastKickAt","bomb_id","b","reset","createTouchControls","device","touch","iOS","android","navigator","maxTouchPoints","g","cameraOffset","cssSafeBottom","v","getComputedStyle","documentElement","getPropertyValue","parseInt","toString","replace","trim","isFinite","padBottom","baseX","baseY","baseR","knobR","base","graphics","beginFill","lineStyle","drawCircle","endFill","inputEnabled","enableDrag","knob","resetDir","setDirFromVector","dx","dy","onPointer","pointer","len","sqrt","clamped","onInputDown","onInputUp","onInputOut","addMoveCallback","mkBtn","onUp","strokeAlpha","btn","onSizeChange","level","tiles","wallIdx","putTile","_sdText","ghost","onSpeed","has","_wasOnSpeed","_lastPortalAt","isBlockedCell","getTile","collides","hasBombAt","some","findSafeLanding","c0","r0","tryCell","ok","rad","dr","dc","portalIndex","findIndex","pairIndex","target","landing","px","py","dist","pull","owner_id","blastedCells","destroyed","empty","summary","reason","mode","winner_skin","Win","winnerText","onTap","returnToMenu","ENTER","dur","durationMs","teamKills","top","perPlayer","survivalMs","kills","why","Game","AUTO","config","__phaserGame"],"sourceRoot":""}